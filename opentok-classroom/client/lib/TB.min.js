/*!
 * OpenTok JavaScript Library v1.1.1
 * http://www.tokbox.com/
 *
 * Copyright (c) 2011 TokBox, Inc.
 *
 * Date: December 04 15:39:58 2012
 */

(function(){var w=this;var j=w._;var E={};var D=Array.prototype,f=Object.prototype,r=Function.prototype;var n=D.slice,A=D.unshift,c=f.toString,h=f.hasOwnProperty;var M=D.forEach,q=D.map,F=D.reduce,b=D.reduceRight,a=D.filter,B=D.every,o=D.some,m=D.indexOf,k=D.lastIndexOf,t=Array.isArray,e=Object.keys,G=r.bind;var N=function(p){return new u(p)};if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=N}exports._=N}else{w._=N}N.VERSION="1.3.3";var J=N.each=N.forEach=function(S,R,Q){if(S==null){return}if(M&&S.forEach===M){S.forEach(R,Q)}else{if(S.length===+S.length){for(var P=0,p=S.length;P<p;P++){if(P in S&&R.call(Q,S[P],P,S)===E){return}}}else{for(var O in S){if(N.has(S,O)){if(R.call(Q,S[O],O,S)===E){return}}}}}};N.map=N.collect=function(Q,P,O){var p=[];if(Q==null){return p}if(q&&Q.map===q){return Q.map(P,O)}J(Q,function(T,R,S){p[p.length]=P.call(O,T,R,S)});if(Q.length===+Q.length){p.length=Q.length}return p};N.reduce=N.foldl=N.inject=function(R,Q,p,P){var O=arguments.length>2;if(R==null){R=[]}if(F&&R.reduce===F){if(P){Q=N.bind(Q,P)}return O?R.reduce(Q,p):R.reduce(Q)}J(R,function(U,S,T){if(!O){p=U;O=true}else{p=Q.call(P,p,U,S,T)}});if(!O){throw new TypeError("Reduce of empty array with no initial value")}return p};N.reduceRight=N.foldr=function(R,Q,p,P){var O=arguments.length>2;if(R==null){R=[]}if(b&&R.reduceRight===b){if(P){Q=N.bind(Q,P)}return O?R.reduceRight(Q,p):R.reduceRight(Q)}var S=N.toArray(R).reverse();if(P&&!O){Q=N.bind(Q,P)}return O?N.reduce(S,Q,p,P):N.reduce(S,Q)};N.find=N.detect=function(Q,P,O){var p;z(Q,function(T,R,S){if(P.call(O,T,R,S)){p=T;return true}});return p};N.filter=N.select=function(Q,P,O){var p=[];if(Q==null){return p}if(a&&Q.filter===a){return Q.filter(P,O)}J(Q,function(T,R,S){if(P.call(O,T,R,S)){p[p.length]=T}});return p};N.reject=function(Q,P,O){var p=[];if(Q==null){return p}J(Q,function(T,R,S){if(!P.call(O,T,R,S)){p[p.length]=T}});return p};N.every=N.all=function(Q,P,O){var p=true;if(Q==null){return p}if(B&&Q.every===B){return Q.every(P,O)}J(Q,function(T,R,S){if(!(p=p&&P.call(O,T,R,S))){return E}});return !!p};var z=N.some=N.any=function(Q,P,O){P||(P=N.identity);var p=false;if(Q==null){return p}if(o&&Q.some===o){return Q.some(P,O)}J(Q,function(T,R,S){if(p||(p=P.call(O,T,R,S))){return E}});return !!p};N.include=N.contains=function(P,O){var p=false;if(P==null){return p}if(m&&P.indexOf===m){return P.indexOf(O)!=-1}p=z(P,function(Q){return Q===O});return p};N.invoke=function(O,P){var p=n.call(arguments,2);return N.map(O,function(Q){return(N.isFunction(P)?P||Q:Q[P]).apply(Q,p)})};N.pluck=function(O,p){return N.map(O,function(P){return P[p]})};N.max=function(Q,P,O){if(!P&&N.isArray(Q)&&Q[0]===+Q[0]){return Math.max.apply(Math,Q)}if(!P&&N.isEmpty(Q)){return -Infinity}var p={computed:-Infinity};J(Q,function(U,R,T){var S=P?P.call(O,U,R,T):U;S>=p.computed&&(p={value:U,computed:S})});return p.value};N.min=function(Q,P,O){if(!P&&N.isArray(Q)&&Q[0]===+Q[0]){return Math.min.apply(Math,Q)}if(!P&&N.isEmpty(Q)){return Infinity}var p={computed:Infinity};J(Q,function(U,R,T){var S=P?P.call(O,U,R,T):U;S<p.computed&&(p={value:U,computed:S})});return p.value};N.shuffle=function(P){var p=[],O;J(P,function(S,Q,R){O=Math.floor(Math.random()*(Q+1));p[Q]=p[O];p[O]=S});return p};N.sortBy=function(P,Q,p){var O=N.isFunction(Q)?Q:function(R){return R[Q]};return N.pluck(N.map(P,function(T,R,S){return{value:T,criteria:O.call(p,T,R,S)}}).sort(function(U,T){var S=U.criteria,R=T.criteria;if(S===void 0){return 1}if(R===void 0){return -1}return S<R?-1:S>R?1:0}),"value")};N.groupBy=function(P,Q){var p={};var O=N.isFunction(Q)?Q:function(R){return R[Q]};J(P,function(T,R){var S=O(T,R);(p[S]||(p[S]=[])).push(T)});return p};N.sortedIndex=function(S,R,P){P||(P=N.identity);var p=0,Q=S.length;while(p<Q){var O=(p+Q)>>1;P(S[O])<P(R)?p=O+1:Q=O}return p};N.toArray=function(p){if(!p){return[]}if(N.isArray(p)){return n.call(p)}if(N.isArguments(p)){return n.call(p)}if(p.toArray&&N.isFunction(p.toArray)){return p.toArray()}return N.values(p)};N.size=function(p){return N.isArray(p)?p.length:N.keys(p).length};N.first=N.head=N.take=function(P,O,p){return(O!=null)&&!p?n.call(P,0,O):P[0]};N.initial=function(P,O,p){return n.call(P,0,P.length-((O==null)||p?1:O))};N.last=function(P,O,p){if((O!=null)&&!p){return n.call(P,Math.max(P.length-O,0))}else{return P[P.length-1]}};N.rest=N.tail=function(P,p,O){return n.call(P,(p==null)||O?1:p)};N.compact=function(p){return N.filter(p,function(O){return !!O})};N.flatten=function(O,p){return N.reduce(O,function(P,Q){if(N.isArray(Q)){return P.concat(p?Q:N.flatten(Q))}P[P.length]=Q;return P},[])};N.without=function(p){return N.difference(p,n.call(arguments,1))};N.uniq=N.unique=function(R,Q,P){var p=P?N.map(R,P):R;var O=[];if(R.length<3){Q=true}N.reduce(p,function(S,U,T){if(Q?N.last(S)!==U||!S.length:!N.include(S,U)){S.push(U);O.push(R[T])}return S},[]);return O};N.union=function(){return N.uniq(N.flatten(arguments,true))};N.intersection=N.intersect=function(O){var p=n.call(arguments,1);return N.filter(N.uniq(O),function(P){return N.every(p,function(Q){return N.indexOf(Q,P)>=0})})};N.difference=function(O){var p=N.flatten(n.call(arguments,1),true);return N.filter(O,function(P){return !N.include(p,P)})};N.zip=function(){var p=n.call(arguments);var Q=N.max(N.pluck(p,"length"));var P=new Array(Q);for(var O=0;O<Q;O++){P[O]=N.pluck(p,""+O)}return P};N.indexOf=function(R,P,Q){if(R==null){return -1}var O,p;if(Q){O=N.sortedIndex(R,P);return R[O]===P?O:-1}if(m&&R.indexOf===m){return R.indexOf(P)}for(O=0,p=R.length;O<p;O++){if(O in R&&R[O]===P){return O}}return -1};N.lastIndexOf=function(P,O){if(P==null){return -1}if(k&&P.lastIndexOf===k){return P.lastIndexOf(O)}var p=P.length;while(p--){if(p in P&&P[p]===O){return p}}return -1};N.range=function(S,Q,R){if(arguments.length<=1){Q=S||0;S=0}R=arguments[2]||1;var O=Math.max(Math.ceil((Q-S)/R),0);var p=0;var P=new Array(O);while(p<O){P[p++]=S;S+=R}return P};var H=function(){};N.bind=function d(Q,O){var P,p;if(Q.bind===G&&G){return G.apply(Q,n.call(arguments,1))}if(!N.isFunction(Q)){throw new TypeError}p=n.call(arguments,2);return P=function(){if(!(this instanceof P)){return Q.apply(O,p.concat(n.call(arguments)))}H.prototype=Q.prototype;var S=new H;var R=Q.apply(S,p.concat(n.call(arguments)));if(Object(R)===R){return R}return S}};N.bindAll=function(O){var p=n.call(arguments,1);if(p.length==0){p=N.functions(O)}J(p,function(P){O[P]=N.bind(O[P],O)});return O};N.memoize=function(P,O){var p={};O||(O=N.identity);return function(){var Q=O.apply(this,arguments);return N.has(p,Q)?p[Q]:(p[Q]=P.apply(this,arguments))}};N.delay=function(O,P){var p=n.call(arguments,2);return setTimeout(function(){return O.apply(null,p)},P)};N.defer=function(p){return N.delay.apply(N,[p,1].concat(n.call(arguments,1)))};N.throttle=function(P,Q){var O,S,T,U,R,V;var p=N.debounce(function(){R=U=false},Q);return function(){O=this;S=arguments;var W=function(){T=null;if(R){P.apply(O,S)}p()};if(!T){T=setTimeout(W,Q)}if(U){R=true}else{V=P.apply(O,S)}p();U=true;return V}};N.debounce=function(O,Q,p){var P;return function(){var T=this,S=arguments;var R=function(){P=null;if(!p){O.apply(T,S)}};if(p&&!P){O.apply(T,S)}clearTimeout(P);P=setTimeout(R,Q)}};N.once=function(P){var p=false,O;return function(){if(p){return O}p=true;return O=P.apply(this,arguments)}};N.wrap=function(p,O){return function(){var P=[p].concat(n.call(arguments,0));return O.apply(this,P)}};N.compose=function(){var p=arguments;return function(){var O=arguments;for(var P=p.length-1;P>=0;P--){O=[p[P].apply(this,O)]}return O[0]}};N.after=function(O,p){if(O<=0){return p()}return function(){if(--O<1){return p.apply(this,arguments)}}};N.keys=e||function(P){if(P!==Object(P)){throw new TypeError("Invalid object")}var O=[];for(var p in P){if(N.has(P,p)){O[O.length]=p}}return O};N.values=function(p){return N.map(p,N.identity)};N.functions=N.methods=function(P){var O=[];for(var p in P){if(N.isFunction(P[p])){O.push(p)}}return O.sort()};N.extend=function(p){J(n.call(arguments,1),function(O){for(var P in O){p[P]=O[P]}});return p};N.pick=function(O){var p={};J(N.flatten(n.call(arguments,1)),function(P){if(P in O){p[P]=O[P]}});return p};N.defaults=function(p){J(n.call(arguments,1),function(O){for(var P in O){if(p[P]==null){p[P]=O[P]}}});return p};N.clone=function(p){if(!N.isObject(p)){return p}return N.isArray(p)?p.slice():N.extend({},p)};N.tap=function(O,p){p(O);return O};function K(Q,P,O){if(Q===P){return Q!==0||1/Q==1/P}if(Q==null||P==null){return Q===P}if(Q._chain){Q=Q._wrapped}if(P._chain){P=P._wrapped}if(Q.isEqual&&N.isFunction(Q.isEqual)){return Q.isEqual(P)}if(P.isEqual&&N.isFunction(P.isEqual)){return P.isEqual(Q)}var T=c.call(Q);if(T!=c.call(P)){return false}switch(T){case"[object String]":return Q==String(P);case"[object Number]":return Q!=+Q?P!=+P:(Q==0?1/Q==1/P:Q==+P);case"[object Date]":case"[object Boolean]":return +Q==+P;case"[object RegExp]":return Q.source==P.source&&Q.global==P.global&&Q.multiline==P.multiline&&Q.ignoreCase==P.ignoreCase}if(typeof Q!="object"||typeof P!="object"){return false}var U=O.length;while(U--){if(O[U]==Q){return true}}O.push(Q);var S=0,p=true;if(T=="[object Array]"){S=Q.length;p=S==P.length;if(p){while(S--){if(!(p=S in Q==S in P&&K(Q[S],P[S],O))){break}}}}else{if("constructor" in Q!="constructor" in P||Q.constructor!=P.constructor){return false}for(var R in Q){if(N.has(Q,R)){S++;if(!(p=N.has(P,R)&&K(Q[R],P[R],O))){break}}}if(p){for(R in P){if(N.has(P,R)&&!(S--)){break}}p=!S}}O.pop();return p}N.isEqual=function(O,p){return K(O,p,[])};N.isEmpty=function(O){if(O==null){return true}if(N.isArray(O)||N.isString(O)){return O.length===0}for(var p in O){if(N.has(O,p)){return false}}return true};N.isElement=function(p){return !!(p&&p.nodeType==1)};N.isArray=t||function(p){return c.call(p)=="[object Array]"};N.isObject=function(p){return p===Object(p)};N.isArguments=function(p){return c.call(p)=="[object Arguments]"};if(!N.isArguments(arguments)){N.isArguments=function(p){return !!(p&&N.has(p,"callee"))}}N.isFunction=function(p){return c.call(p)=="[object Function]"};N.isString=function(p){return c.call(p)=="[object String]"};N.isNumber=function(p){return c.call(p)=="[object Number]"};N.isFinite=function(p){return N.isNumber(p)&&isFinite(p)};N.isNaN=function(p){return p!==p};N.isBoolean=function(p){return p===true||p===false||c.call(p)=="[object Boolean]"};N.isDate=function(p){return c.call(p)=="[object Date]"};N.isRegExp=function(p){return c.call(p)=="[object RegExp]"};N.isNull=function(p){return p===null};N.isUndefined=function(p){return p===void 0};N.has=function(O,p){return h.call(O,p)};N.noConflict=function(){w._=j;return this};N.identity=function(p){return p};N.times=function(Q,P,O){for(var p=0;p<Q;p++){P.call(O,p)}};N.escape=function(p){return(""+p).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};N.result=function(p,P){if(p==null){return null}var O=p[P];return N.isFunction(O)?O.call(p):O};N.mixin=function(p){J(N.functions(p),function(O){x(O,N[O]=p[O])})};var y=0;N.uniqueId=function(p){var O=y++;return p?p+O:O};N.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var v=/.^/;var g={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var I in g){g[g[I]]=I}var i=/\\|'|\r|\n|\t|\u2028|\u2029/g;var C=/\\(\\|'|r|n|t|u2028|u2029)/g;var L=function(p){return p.replace(C,function(O,P){return g[P]})};N.template=function(S,R,P){P=N.defaults(P||{},N.templateSettings);var Q="__p+='"+S.replace(i,function(T){return"\\"+g[T]}).replace(P.escape||v,function(T,U){return"'+\n_.escape("+L(U)+")+\n'"}).replace(P.interpolate||v,function(T,U){return"'+\n("+L(U)+")+\n'"}).replace(P.evaluate||v,function(T,U){return"';\n"+L(U)+"\n;__p+='"})+"';\n";if(!P.variable){Q="with(obj||{}){\n"+Q+"}\n"}Q="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+Q+"return __p;\n";var O=new Function(P.variable||"obj","_",Q);if(R){return O(R,N)}var p=function(T){return O.call(this,T,N)};p.source="function("+(P.variable||"obj")+"){\n"+Q+"}";return p};N.chain=function(p){return N(p).chain()};var u=function(p){this._wrapped=p};N.prototype=u.prototype;var s=function(O,p){return p?N(O).chain():O};var x=function(p,O){u.prototype[p]=function(){var P=n.call(arguments);A.call(P,this._wrapped);return s(O.apply(N,P),this._chain)}};N.mixin(N);J(["pop","push","reverse","shift","sort","splice","unshift"],function(p){var O=D[p];u.prototype[p]=function(){var P=this._wrapped;O.apply(P,arguments);var Q=P.length;if((p=="shift"||p=="splice")&&Q===0){delete P[0]}return s(P,this._chain)}});J(["concat","join","slice"],function(p){var O=D[p];u.prototype[p]=function(){return s(O.apply(this._wrapped,arguments),this._chain)}});u.prototype.chain=function(){this._chain=true;return this};u.prototype.value=function(){return this._wrapped}}).call(this);
/*
 *  This is a modified version of Robert Kieffer awesome uuid.js library.
 *  The only modifications we've made are to remove the Node.js specific
 *  parts of the code and the UUID version 1 generator (which we don't
 *  use). The original copyright notice is below.
 *
 *     node-uuid/uuid.js
 *
 *     Copyright (c) 2010 Robert Kieffer
 *     Dual licensed under the MIT and GPL licenses.
 *     Documentation and details at https://github.com/broofa/node-uuid
 */
(function(){var n=this;var f,e;var q=new Array(16);f=function(){var u,s=q,t=0;for(t=0;t<16;t++){if((t&3)===0){u=Math.random()*4294967296}s[t]=u>>>((t&3)<<3)&255}return s};if(n.crypto&&crypto.getRandomValues){var b=new Uint32Array(4);e=function(){crypto.getRandomValues(b);for(var i=0;i<16;i++){q[i]=b[i>>2]>>>((i&3)*8)&255}return q}}var d=e||f;var m=typeof(Buffer)=="function"?Buffer:Array;var p=[];var j={};for(var h=0;h<256;h++){p[h]=(h+256).toString(16).substr(1);j[p[h]]=h}function g(v,r,w){var t=(r&&w)||0,u=0;r=r||[];v.toLowerCase().replace(/[0-9a-f]{2}/g,function(i){if(u<16){r[t+u++]=j[i]}});while(u<16){r[t+u++]=0}return r}function k(r,t){var s=t||0,u=p;return u[r[s++]]+u[r[s++]]+u[r[s++]]+u[r[s++]]+"-"+u[r[s++]]+u[r[s++]]+"-"+u[r[s++]]+u[r[s++]]+"-"+u[r[s++]]+u[r[s++]]+"-"+u[r[s++]]+u[r[s++]]+u[r[s++]]+u[r[s++]]+u[r[s++]]+u[r[s++]]}function o(s,r,w){var t=r&&w||0;if(typeof(s)=="string"){r=s=="binary"?new m(16):null;s=null}s=s||{};var v=s.random||(s.rng||d)();v[6]=(v[6]&15)|64;v[8]=(v[8]&63)|128;if(r){for(var u=0;u<16;u++){r[t+u]=v[u]}}return r||k(v)}var a=o;a.v4=o;a.parse=g;a.unparse=k;a.BufferClass=m;a.mathRNG=f;a.whatwgRNG=e;var c=n.uuid;a.noConflict=function(){n.uuid=c;return a};n.uuid=a}());(function(c){if(location.protocol==="file:"){alert("You cannot test a page using WebRTC through the file system due to browser permissions. You must run it over a web server.")}if(!c.URL&&c.webkitURL){c.URL=c.webkitURL}var a=0,b,e=document.location.hash,f;var d={initSession:function(g){if(!this.sessions[g]){this.sessions[g]=new d.Session(g)}return this.sessions[g]},initPublisher:function(j,g,h){d.debug("TB.initPublisher("+g+")");var i=new d.rtc.Publisher();i.publish(g,h);return i},checkSystemRequirements:function(){d.debug("TB.checkSystemRequirements()");var g=d.$.supportsWebSockets()&&d.$.supportsWebRTC()?this.HAS_REQUIREMENTS:this.NOT_HAS_REQUIREMENTS;d.checkSystemRequirements=function(){d.debug("TB.checkSystemRequirements()");return g};return g},upgradeSystemRequirements:function(){d.onLoad(function(){var g="_upgradeFlash";document.body.appendChild((function(){var h=document.createElement("iframe");h.id=g;h.style.position="absolute";h.style.position="fixed";h.style.height="100%";h.style.width="100%";h.style.top="0px";h.style.left="0px";h.style.right="0px";h.style.bottom="0px";h.style.zIndex=1000;h.style.backgroundColor="rgba(0,0,0,0.2)";h.src=d.BUILD_PROPERTIES.widgetURL+"/html/upgradeFlash.html#"+encodeURIComponent(document.location.href);return h})());if(b){clearInterval(b)}b=setInterval(function(){var i=document.location.hash,h=/^#?\d+&/;if(i!==e&&h.test(i)){e=i;if(i.replace(h,"")==="close_window"){document.body.removeChild(document.getElementById(g));document.location.hash=""}}},100)})},reportIssue:function(){d.warn("ToDo: haven't yet implemented TB.reportIssue")},components:{},sessions:{},rtc:{},behaviours:{},APIKEY:(function(){var h=(function(){var i=document.getElementsByTagName("script");i=i[i.length-1];i=i.getAttribute("src")||i.src;return i})();var g=h.match(/[\?\&]apikey=([^&]+)/i);return g?g[1]:""})(),HAS_REQUIREMENTS:1,NOT_HAS_REQUIREMENTS:0};d._=_.noConflict();c.OT=d;c.TB=d})(window);OT.BUILD_PROPERTIES={apiURL:"http://anvil.opentok.com",messagingServer:"staging.tokbox.com",loggingURL:"http://hlg.tokbox.com/prod",widgetURL:"http://static.opentok.com/webrtc/v2.0.1",version:"v2.0.1"};if(true&&window.location.protocol.indexOf("https")>=0){OT.BUILD_PROPERTIES.widgetURL="https://swww.tokbox.com/webrtc/v2.0.1";OT.BUILD_PROPERTIES.loggingURL="https://api.opentok.com/hl";OT.BUILD_PROPERTIES.apiURL="https://anvil.opentok.com"}OT.BUILD_PROPERTIES.configURL=OT.BUILD_PROPERTIES.widgetURL+"/js/dynamic_config.min.js";OT.BUILD_PROPERTIES.cssURL=OT.BUILD_PROPERTIES.widgetURL+"/css";(function(a){OT.eventing=function(c){var f={};function b(h,g){if(!h){return}h.apply(null,g.slice())}function e(g,i,h,k){if(!g||g.length===0){return}var j=g.length,m=j;g.forEach(function(o,n){setTimeout(function(){try{o.apply(null,i)}finally{m--;if(m===0){b(k,i)}}},1)})}function d(g){if(f[g]){delete f[g]}}c.dispatchEvent=function(h,g){if(!h.type){OT.error("OT.Eventing.dispatchEvent: Event has no type");OT.error(h);throw new Error("OT.Eventing.dispatchEvent: Event has no type")}if(!h.target){h.target=this}if(!f[h.type]||f[h.type].length===0){b(g,[h]);return}e(f[h.type],[h],h.type,g);return this};c.trigger=function(g){if(!f[g]||f[g].length===0){return}var h=Array.prototype.slice.call(arguments);h.shift();e(f[g],h,g);return this};c.on=function(g,i){if(typeof(g)==="string"&&i){this.addEventListener(g,i)}else{for(var h in g){if(g.hasOwnProperty(h)){this.addEventListener(h,g[h])}}}return this};c.off=function(g,i){if(typeof(g)==="string"){if(i){this.removeEventListener(g,i)}else{d(g)}}else{for(var h in g){if(g.hasOwnProperty(h)){this.removeEventListener(h,g[h])}}}return this};c.addEventListener=function(g,h){if(!f[g]){f[g]=[]}f[g].push(h)};c.removeEventListener=function(g,h){if(f[g]){f[g]=OT._.without(f[g],h)}};return c};OT.eventing(OT)})(window);(function(a){OT.Event=function(e,c){this.type=e;this.cancelable=c!==undefined?c:true;var d=false,b=null;this.preventDefault=function(){if(this.cancelable){d=true}else{OT.warn("Event.preventDefault :: Trying to preventDefault on an Event that isn't cancelable")}};this.isDefaultPrevented=function(){return d};Object.defineProperty(this,"target",{set:function(f){b=f},get:function(){return b}})};OT.Event.names={ACTIVE:"active",INACTIVE:"inactive",UNKNOWN:"unknown",PER_SESSION:"perSession",PER_STREAM:"perStream",EXCEPTION:"exception",ISSUE_REPORTED:"issueReported",SESSION_CONNECTED:"sessionConnected",SESSION_DISCONNECTED:"sessionDisconnected",STREAM_CREATED:"streamCreated",STREAM_DESTROYED:"streamDestroyed",CONNECTION_CREATED:"connectionCreated",CONNECTION_DESTROYED:"connectionDestroyed",SIGNAL_RECEIVED:"signalReceived",STREAM_PROPERTY_CHANGED:"streamPropertyChanged",MICROPHONE_LEVEL_CHANGED:"microphoneLevelChanged",ARCHIVE_CREATED:"archiveCreated",ARCHIVE_CLOSED:"archiveClosed",ARCHIVE_LOADED:"archiveLoaded",ARCHIVE_SAVED:"archiveSaved",SESSION_RECORDING_STARTED:"sessionRecordingStarted",SESSION_RECORDING_STOPPED:"sessionRecordingStopped",SESSION_RECORDING_IN_PROGRESS:"sessionRecordingInProgress",STREAM_RECORDING_IN_PROGRESS:"streamRecordingInProgress",SESSION_NOT_RECORDING:"sessionNotRecording",STREAM_NOT_RECORDING:"streamNotRecording",STREAM_RECORDING_STARTED:"streamRecordingStarted",STREAM_RECORDING_STOPPED:"streamRecordingStopped",PLAYBACK_STARTED:"playbackStarted",PLAYBACK_PAUSED:"playbackPaused",PLAYBACK_STOPPED:"playbackStopped",RECORDING_STARTED:"recordingStarted",RECORDING_STOPPED:"recordingStopped",RESIZE:"resize",SETTINGS_BUTTON_CLICK:"settingsButtonClick",DEVICE_INACTIVE:"deviceInactive",INVALID_DEVICE_NAME:"invalidDeviceName",ACCESS_ALLOWED:"accessAllowed",ACCESS_DENIED:"accessDenied",ACCESS_DIALOG_OPENED:"accessDialogOpened",ACCESS_DIALOG_CLOSED:"accessDialogClosed",ECHO_CANCELLATION_MODE_CHANGED:"echoCancellationModeChanged",DEVICES_DETECTED:"devicesDetected",DEVICES_SELECTED:"devicesSelected",CLOSE_BUTTON_CLICK:"closeButtonClick",MICLEVEL:"microphoneActivityLevel",MICGAINCHANGED:"microphoneGainChanged",DYNAMIC_CONFIG_CHANGED:"dynamicConfigChanged",DYNAMIC_CONFIG_LOAD_FAILED:"dynamicConfigLoadFailed",ENV_LOADED:"envLoaded"};OT.ValueEvent=function(b,c){OT.Event.call(this,b);this.value=c};OT.ExceptionCodes={JS_EXCEPTION:2000,AUTHENTICATION_ERROR:1004,INVALID_SESSION_ID:1005,CONNECT_FAILED:1006,CONNECT_REJECTED:1007,CONNECTION_TIMEOUT:1008,P2P_CONNECTION_FAILED:1013,API_RESPONSE_FAILURE:1014,UNABLE_TO_PUBLISH:1500,UNABLE_TO_SIGNAL:1510,UNABLE_TO_FORCE_DISCONNECT:1520,UNABLE_TO_FORCE_UNPUBLISH:1530};OT.ExceptionEvent=function(c,e,f,d,b){OT.Event.call(this,c);this.message=e;this.title=f;this.code=d;this.component=b};OT.IssueReportedEvent=function(b,c){OT.Event.call(this,b);this.issueId=c};OT.EnvLoadedEvent=function(b){OT.Event.call(this,b)};OT.DynamicConfigChangedEvent=function(b){OT.Event.call(this,b)};OT.DynamicConfigLoadFailedEvent=function(b){OT.Event.call(this,b)};OT.ConnectionEvent=function(c,b,d){OT.Event.call(this,c);this.connections=b;this.reason=d};OT.StreamEvent=function(c,e,d,b){OT.Event.call(this,c,b);this.streams=e;this.reason=d};OT.SessionConnectEvent=function(d,c,e,b){OT.Event.call(this,d);this.connections=c;this.streams=e;this.archives=b;this.groups=[]};OT.SessionDisconnectEvent=function(c,d,b){OT.Event.call(this,c,b);this.reason=d};OT.VolumeEvent=function(b,d,c){OT.Event.call(this,b);this.streamId=d;this.volume=c};OT.DeviceEvent=function(c,b,d){OT.Event.call(this,c);this.camera=b;this.microphone=d};OT.DeviceStatusEvent=function(e,b,d,c,f){OT.Event.call(this,e);this.cameras=b;this.microphones=d;this.selectedCamera=c;this.selectedMicrophone=f};OT.ResizeEvent=function(c,d,b,f,e){OT.Event.call(this,c);this.widthFrom=d;this.widthTo=b;this.heightFrom=f;this.heightTo=e};OT.StreamPropertyChangedEvent=function(c,e,f,b,d){OT.Event.call(this,c);this.type=c;this.stream=e;this.changedProperty=f;this.oldValue=b;this.newValue=d};OT.ArchiveEvent=function(c,b){OT.Event.call(this,c);this.archives=b};OT.ArchiveStreamEvent=function(c,b,d){OT.Event.call(this,c);this.archive=b;this.streams=d};OT.StateChangedEvent=function(b,c){OT.Event.call(this,b);this.changedValues=c};OT.ChangeFailedEvent=function(b,e,c,d){OT.Event.call(this,b);this.reasonCode=e;this.reason=c;this.failedValues=d}})(window);(function(a){OT.Config=(function(){var j=4000,n=false,h={},c={},e,f=document.head||document.getElementsByTagName("head")[0],m,k=function(){if(m){clearTimeout(m);m=null}},b=function(){k();if(e){e.onload=e.onreadystatechange=null;if(f&&e.parentNode){f.removeChild(e)}e=undefined}},d=function(){if(e.readyState&&!/loaded|complete/.test(e.readyState)){return}k();if(!n){g._onLoadTimeout()}},i=function(o,p){if(p&&c[p]&&c[p][o]){return c[p][o]}return h[o]},g={load:function(){n=false;setTimeout(function(){e=document.createElement("script");e.async="async";e.src=OT.BUILD_PROPERTIES.configURL;e.onload=e.onreadystatechange=OT._.bind(d,this);f.appendChild(e)},1);m=setTimeout(function(){g._onLoadTimeout()},j)},_onLoadTimeout:function(){b();OT.warn("TB DynamicConfig failed to load in "+j+" ms");this.dispatchEvent(new OT.DynamicConfigLoadFailedEvent(OT.Event.names.DYNAMIC_CONFIG_LOAD_FAILED))},isLoaded:function(){return n},reset:function(){b();n=false;h={};c={}},replaceWith:function(o){b();if(!o){o={}}h=o.global||{};c=o.partners||{};if(!n){n=true}this.dispatchEvent(new OT.DynamicConfigChangedEvent(OT.Event.names.DYNAMIC_CONFIG_CHANGED))},get:function(o,q,r){var p=i(o,r);return p?p[q]:null}};OT.eventing(g);return g})()})(window);(function(c){function b(){var d=false,f=false,i=function(){return f&&d},g=function(){if(i()){OT.dispatchEvent(new OT.EnvLoadedEvent(OT.Event.names.ENV_LOADED))}},j=function(){f=true;OT.Config.load();g()},e=function(){d=true;OT.Config.off(OT.Event.names.DYNAMIC_CONFIG_CHANGED,e);OT.Config.off(OT.Event.names.DYNAMIC_CONFIG_LOAD_FAILED,h);g()},h=function(){e()};document.addEventListener("DOMContentLoaded",j,false);OT.Config.on(OT.Event.names.DYNAMIC_CONFIG_CHANGED,e);OT.Config.on(OT.Event.names.DYNAMIC_CONFIG_LOAD_FAILED,h);this.onLoad=function(k){if(i()){k();return}OT.on(OT.Event.names.ENV_LOADED,k)}}var a=new b();OT.onLoad=function(d){a.onLoad(d)}})(window);(function(a){OT.WebSocketMessageType={CONNECTED_TO_WEBSOCKET_SERVER:1000,CONNECT_TO_SESSION:1001,SIGNAL:1002,CONNECTION_CREATED:1003,CONNECTION_DESTROYED:1004,CONNECTION_COUNT_CHANGED:1005,STREAM_CREATED:1006,STREAM_MODIFIED:1007,STREAM_DESTROYED:1008,FORCE_DISCONNECT:1009,FORCE_UNPUBLISH:1010,JSEP_OFFER:1011,JSEP_ANSWER:1012,JSEP_PRANSWER:1013,JSEP_CANDIDATE:1014,JSEP_SUBSCRIBE:1015,JSEP_UNSUBSCRIBE:1016,WEBSOCKET_PING:1017,WEBSOCKET_PONG:1018,SESSION_CONNECT_FAILED:1100,PUBLISH_FAILED:1101,SUBSCRIBE_FAILED:1102,FORCEDISCONNECT_FAILED:1103,FORCEUNPUBLISH_FAILED:1104}})(window);(function(a){OT.WebSocketMessage=function(b,c){this.type=b;this.payload=c;this.toString=function(){return JSON.stringify(this)}};OT.WebSocketMessage.connectToSessionMessage=function(f,e,c,d,b){return{type:OT.WebSocketMessageType.CONNECT_TO_SESSION,payload:{sessionId:f,apiKey:e,token:c,supportsWebRTC:OT.$.supportsWebRTC(),connectionObjects:d,p2pEnabled:b}}};OT.WebSocketMessage.signalMessage=function(b,d,c){return{type:OT.WebSocketMessageType.SIGNAL,payload:{fromAddress:b,toAddresses:d,messagePayload:c}}};OT.WebSocketMessage.createStream=function(g,b,c,j,i,f,d,h){var e={type:OT.WebSocketMessageType.STREAM_CREATED,payload:{publisherId:g,name:b,orientation:{videoOrientation:c,width:j,height:i},hasAudio:f,hasVideo:d,p2pEnabled:h}};return e};OT.WebSocketMessage.modifyStream=function(e,b,d){var c={type:OT.WebSocketMessageType.STREAM_MODIFIED,payload:{streamId:e,key:b,value:d}};return c};OT.WebSocketMessage.destroyStream=function(b){return{type:OT.WebSocketMessageType.STREAM_DESTROYED,payload:{streamId:b}}};OT.WebSocketMessage.jsepMessage=function(d,f,b,e){e.fromAddress=d;e.toAddresses=f;var c={type:b,payload:e};return c};OT.WebSocketMessage.forceDisconnect=function(b){return{type:OT.WebSocketMessageType.FORCE_DISCONNECT,payload:{connectionId:b}}};OT.WebSocketMessage.forceUnpublish=function(b){return{type:OT.WebSocketMessageType.FORCE_UNPUBLISH,payload:{streamId:b}}};OT.WebSocketMessage.pingMessage=function(c,b){return{type:OT.WebSocketMessageType.WEBSOCKET_PING,payload:{message:b,timestamp:(+Date.now()).toString()}}};OT.WebSocketMessage.pongMessage=function(b,c){return{type:OT.WebSocketMessageType.WEBSOCKET_PONG,payload:{message:b,timestamp:parseInt(c,10)}}}})(window);(function(a){OT.Messenger=function(m,B){var b={};b[OT.WebSocketMessageType.CONNECT_TO_SESSION]={type:"SessionConnected",afterConnected:false};b[OT.WebSocketMessageType.SESSION_CONNECT_FAILED]={type:"SessionConnectFailed",afterConnected:false};b[OT.WebSocketMessageType.CONNECTION_CREATED]={type:"ConnectionCreated",afterConnected:true};b[OT.WebSocketMessageType.CONNECTION_DESTROYED]={type:"ConnectionDestroyed",afterConnected:true};b[OT.WebSocketMessageType.STREAM_CREATED]={type:"StreamCreated",afterConnected:true};b[OT.WebSocketMessageType.STREAM_MODIFIED]={type:"StreamModified",afterConnected:true};b[OT.WebSocketMessageType.STREAM_DESTROYED]={type:"StreamDestroyed",afterConnected:true};b[OT.WebSocketMessageType.JSEP_OFFER]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.JSEP_ANSWER]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.JSEP_PRANSWER]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.JSEP_CANDIDATE]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.JSEP_SUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.JSEP_UNSUBSCRIBE]={type:"JSEPMessageReceived",afterConnected:true};b[OT.WebSocketMessageType.SIGNAL]={type:"SignalReceived",afterConnected:true};var A=8081;var c=25000;var d=3*c-100;OT.eventing(this);this.onSessionConnected=null;this.onConnectionClosed=null;this.webSocket=null;this.connectionId=null;var f,g,C,z,k,v=false,s=new OT.Analytics(),x=[],u=false,e=null;this.connect=function(F,D,E){f=F;g=D;C=E;_webSocketUrl="ws://"+m+":"+A+"/rumorwebsockets";s.logEvent({action:"webSocketConnection",variation:"Attempt",payload_type:"webSocketServerUrl",payload:_webSocketUrl,session_id:f,partner_id:C.partnerId,widget_id:C.widgetId});this.webSocket=new WebSocket(_webSocketUrl);this.webSocket.onopen=r;this.webSocket.onclose=o;this.webSocket.onerror=y;this.webSocket.onmessage=j;z=setTimeout(function(){s.logEvent({action:"webSocketConnection",variation:"Failure",payload_type:"webSocketServerUrl",payload:"Connection to the server timed out waiting to receive connected message.",session_id:f,partner_id:C.partnerId,widget_id:C.widgetId});p.trigger("exception","Connection to the server timed out.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15000)};this.disconnect=function(){v=true;if(this.webSocket){this.webSocket.close();this.webSocket=null}};this.sendMessage=function(D){OT.warn("Sending WebSocket message: "+JSON.stringify(D));this.webSocket.send(JSON.stringify(D))};function r(){OT.debug("WebSocket connected");clearTimeout(z);z=setTimeout(function(){s.logEvent({action:"webSocketConnection",variation:"Failure",payload_type:"reason",payload:"Connection to the server timed out waiting to receive connected message.",session_id:f,partner_id:C.partnerId,widget_id:C.widgetId});p.trigger("exception","Connection to the server timed out waiting to receive connected message.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15000)}function y(){p.trigger("exception","TB.Socket Error :: The socket to "+m+" received an error.",OT.ExceptionCodes.CONNECT_FAILED)}function o(){clearTimeout(k);p.trigger("ConnectionClosed",{reason:v?"":"networkDisconnected"})}function j(D){OT.warn("WebSocket message recieved: "+D.data);w(D.data)}function w(F){var D=JSON.parse(F);switch(D.type){case OT.WebSocketMessageType.CONNECTED_TO_WEBSOCKET_SERVER:t(D.payload);break;case OT.WebSocketMessageType.WEBSOCKET_PONG:e=+Date.now();break;case OT.WebSocketMessageType.CONNECT_TO_SESSION:clearTimeout(z);u=true;n();default:if(b.hasOwnProperty(D.type)){var E=b[D.type].type;OT.debug("Received "+E);if(!u&&b[D.type].afterConnected){i(F)}else{p.trigger(E,B.wrangle(D.payload))}}else{OT.debug("Message type "+D.type+" was not handled.")}if(D.type===OT.WebSocketMessageType.CONNECT_TO_SESSION){q()}break}}function i(D){x.push(D)}function q(){while(x.length>0){w(x.shift())}}function h(){if(!e){return false}return(+Date.now()-e)>=d}function n(){if(h()){OT.error("We seem to have lost connectivity!");o()}else{p.sendMessage(OT.WebSocketMessage.pingMessage(p.connectionId,"ping!"));k=setTimeout(n,c)}}function t(D){p.connectionId=D.connectionId;s.logEvent({action:"webSocketConnection",variation:"Success",payload_type:"webSocketServerUrl",payload:_webSocketUrl,session_id:f,partner_id:C.partnerId,widget_id:C.widgetId,connectionId:D.connectionId});clearTimeout(z);z=setTimeout(function(){s.logEvent({action:"webSocketConnection",variation:"Success",payload_type:"webSocketServerUrl",payload:"Connection to the server timed out waiting to receive connected message.",session_id:f,partner_id:C.partnerId,widget_id:C.widgetId});p.trigger("exception","Connection to the server timed out fetching the session state.",OT.ExceptionCodes.CONNECTION_TIMEOUT)},15000);p.sendMessage(OT.WebSocketMessage.connectToSessionMessage(f,OT.APIKEY,g,C.requireConnectionObjects,C.p2pEnabled))}var p=this}})(window);(function(a){OT.log=function(b){console.log(b)};OT.debug=function(b){console.log(b)};OT.info=function(b){console.info(b)};OT.warn=function(b){console.warn(b)};OT.error=function(b){console.error(b)};OT.setLogLevel=function(b){OT.warn("ToDo: Haven't yet implemented TB.setLogLevel")}})(window);(function(a){OT.$=function(b){return document.getElementById(b)};OT.$.noop=function(){};OT.$.supportsWebSockets=function(){return"WebSocket" in a};OT.$.browser=function(){var c=a.navigator.userAgent.toLowerCase(),d,b="Unknown";if(c.indexOf("firefox")>-1){b="Firefox"}if(c.indexOf("opera")>-1){b="Opera"}else{if(c.indexOf("msie")>-1){b="IE"}else{if(c.indexOf("chrome")>-1){b="Chrome"}}}if((d=a.navigator.vendor)&&d.toLowerCase().indexOf("apple")>-1){b="Safari"}c=null;OT.$.browser=function(){return b};return b};OT.$.moreInfoLink=function(c){var d=c?c.apiKey:OT.APIKEY,b=["http://www.tokbox.com/opentok/info"];b[0]+="?guid=a80c00ad22a3e7dcee262f5f7c549c94c794d663";if(c){b.push("session_id="+c.id);if(c.connected){b.push("connection_id="+c.connection.id)}}b.push("partner_id="+d);b.push("utm_source="+d);b.push("utm_medium="+OT.$.browser());if(OT.BUILD_PROPERTIES.widgetURL.indexOf("static")>-1){b.push("utm_campaign=static")}else{b.push("utm_campaign=staging")}return b.join("&")};OT.$.deepClone=function(d){if(!OT._.isObject(d)){return d}var b=OT._.isArray(d)?[]:{};for(var c in d){if(!d.hasOwnProperty(c)){continue}if(OT._.isObject(d[c])){b[c]=this.deepClone(d[c])}else{b[c]=d[c]}}return b};OT.$.JSONify=(JSON&&JSON.stringify)?JSON.stringify:function(c){var b="{ ";for(var d in c){if(typeof(c[d])=="boolean"){b+='"'+d+'":'+c[d]+", "}else{b+='"'+d+'":"'+c[d].toString()+'", '}}if(b.length>1){b=b.substring(0,b.length-2)+" }"}else{b="{}"}return b};OT.$.tbAlert=function(e,c){var b=new OT.Modal(e,"<div>"+c+"</div>");OT.$.addClass(b.el,"OT_tbalert");var d=OT.$.createElement("input",{className:"OT_closeButton",type:"button",value:"close"});b.el.appendChild(d);d.onclick=function(){if(b){b.close()}b=null}};if(!Object.create){Object.create=function(c){if(arguments.length>1){throw new Error("Object.create implementation only accepts the first parameter.")}function b(){}b.prototype=c;return new b()}}})(window);(function(a){OT.$.castToBoolean=function(c,b){if(c===undefined){return b}return c==="true"||c===true}})(window);(function(a){OT.$.supportsClassList=function(){var b=typeof(document!=="undefined")&&("classList" in document.createElement("a"));OT.$.supportsClassList=function(){return b};return b};OT.$.removeElement=function(b){if(b&&b.parentNode){b.parentNode.removeChild(b)}};OT.$.removeElementById=function(b){this.removeElement(OT.$(b))};OT.$.removeElementsByType=function(b,c){if(!b){return}var d=b.getElementsByTagName(c);while(d.length){b.removeChild(d[0])}};OT.$.createElement=function(h,b,g){var e=document.createElement(h);for(var d in b){if(typeof(b[d])==="object"){if(!e[d]){e[d]={}}var c=b[d];for(var f in c){e[d][f]=c[f]}}else{if(d==="className"){e.className=b[d]}else{e.setAttribute(d,b[d])}}}if(g){e.innerHTML=g}return e};OT.$.createButton=function(f,b,e){var d=OT.$.createElement("button",b,f);if(e){for(var c in e){if(e.hasOwnProperty(c)){OT.$.on(d,c,e[c])}}d._boundEvents=e}return d};OT.$.on=function(d,b,e){if(d.addEventListener){d.addEventListener(b,e,false)}else{if(d.attachEvent){d.attachEvent("on"+b,e)}else{var c=d["on"+b];d["on"+b]=function(){e.apply(this,arguments);if(c){c.apply(this,arguments)}}}}}})(window);(function(c){OT.$.addClass=function(e,f){if(e.nodeType!==1){return}var h=f.trim().split(/\s+/),d;if(OT.$.supportsClassList()){for(d=0,l=h.length;d<l;++d){e.classList.add(h[d])}return}if(!e.className&&h.length===1){e.className=f}else{var g=" "+e.className+" ";for(d=0,l=h.length;d<l;++d){if(!~g.indexOf(" "+h[d]+" ")){g+=h[d]+" "}}e.className=g.trim()}return this};OT.$.removeClass=function(e,g){if(!g){return}if(e.nodeType!==1){return}var h=g.trim().split(/\s+/),d;if(OT.$.supportsClassList()){for(d=0,l=h.length;d<l;++d){e.classList.remove(h[d])}return}var f=(" "+e.className+" ").replace(/[\s+]/," ");for(d=0,l=h.length;d<l;++d){f=f.replace(" "+h[d]+" "," ")}e.className=f.trim();return this};var a=function(d){if(d.offsetWidth>0){return d.offsetWidth+"px"}return OT.$.css(d,"width")},b=function(d){if(d.offsetHeight>0){return d.offsetHeight+"px"}return OT.$.css(d,"height")};OT.$.width=function(d){if(d.offsetWidth!==0){return a(d)}else{return OT.$.makeVisibleAndYield(d,function(){return a(d)})}};OT.$.height=function(d){if(d.offsetHeight!==0){return b(d)}else{return OT.$.makeVisibleAndYield(d,function(){return b(d)})}};OT.$.centerElement=function(e,f,d){if(!f){f=parseInt(OT.$.width(e),10)}if(!d){d=parseInt(OT.$.height(e),10)}var h=-0.5*f+"px";var g=-0.5*d+"px";OT.$.css(e,"margin",g+" 0 0 "+h);OT.$.addClass(e,"OT_centered")}})(window);(function(a){var b={};OT.$.show=function(c){var d=c.style.display;if(d===""||d==="none"){c.style.display=b[c]||"";delete b[c]}return this};OT.$.hide=function(c){if(c.style.display==="none"){return}b[c]=OT.$.css(c,"display");c.style.display="none";return this};OT.$.css=function(e,j,h){if(typeof(j)!=="string"){var g=e.style;for(var i in j){g[i]=j[i]}return this}else{if(h){e.style[j]=h;return this}else{var d=j.replace(/([A-Z]|^ms)/g,"-$1").toLowerCase(),c=e.ownerDocument.defaultView.getComputedStyle(e,null),f=c.getPropertyValue(d);if(f===""){f=e.style[d]}return f}}};OT.$.applyCSS=function(e,g,h){var f={},d,c;for(d in g){if(g.hasOwnProperty(d)){f[d]=OT.$.css(e,d);OT.$.css(e,d,g[d])}}c=h();for(d in g){if(g.hasOwnProperty(d)){OT.$.css(e,d,f[d])}}return c};OT.$.makeVisibleAndYield=function(c,d){return OT.$.applyCSS(c,{display:"block",visibility:"hidden"},d)}})(window);(function(b){function a(c){Object.defineProperty(c.prototype,"firstElementChild",{get:function(){var d=this;d=d.firstChild;while(d&&d.nodeType!=1){d=d.nextSibling}return d}});Object.defineProperty(c.prototype,"lastElementChild",{get:function(){var d=this;d=d.lastChild;while(d&&d.nodeType!=1){d=d.previousSibling}return d}});Object.defineProperty(c.prototype,"nextElementSibling",{get:function(){var d=this;while(d=d.nextSibling){if(d.nodeType==1){break}}return d}});Object.defineProperty(c.prototype,"previousElementSibling",{get:function(){var d=this;while(d=d.previousSibling){if(d.nodeType==1){break}}return d}})}OT.$.parseXML=function(e){var c,d;if(b.DOMParser){d=(new DOMParser()).parseFromString(e,"text/xml")}else{d=new ActiveXObject("Microsoft.XMLDOM");d.async="false";d.loadXML(e);a(d)}c=d.documentElement;if(!c||!c.nodeName||c.nodeName==="parsererror"){return null}return d}})(window);(function(b){function a(d,f){if(typeof(d)==="string"){return d}var e=[];for(var c in d){e.push(encodeURIComponent(c)+"="+encodeURIComponent(d[c]))}return e.join("&").replace(/\+/g,"%20")}OT.$.getXML=function(e,d){var f=d&&d.success,g=function(j){var i=j.target.responseXML,h;if(i){h=i.documentElement;if(!h||!h.nodeName||h.nodeName==="parsererror"){i=null}}if(i===null){if(d&&d.error){d.error(j,j.target)}return}if(f){f(i,j,j.target)}};var c=OT._.extend(d.headers||{},{"Content-Type":"application/xml"});OT.$.get(e,OT._.extend(d||{},{success:g,headers:c}))};OT.$.getJSON=function(d,c){var e=c&&c.success,f=function(h){var g;try{g=JSON.parse(h.target.responseText)}catch(i){if(c&&c.error){c.error(h,h.target)}return}if(e){e(g,h,h.target)}};OT.$.get(d,OT._.extend(c||{},{success:f,headers:{"Content-Type":"application/json"}}))};OT.$.get=function(f,e){var g=new XMLHttpRequest(),c=e||{};if(c.success){g.addEventListener("load",c.success,false)}if(c.error){g.addEventListener("error",c.error,false)}if(c.process){g.addEventListener("progress",c.progress,false)}if(c.cancelled){g.addEventListener("abort",c.cancelled,false)}g.open("GET",f,true);if(!c.headers){c.headers={}}for(var d in c.headers){g.setRequestHeader(d,c.headers[d])}g.send()};OT.$.postFormData=function(d,f,c){if(!f){throw new Error("OT.$.postFormData must be passed a data options.")}var g=new FormData();for(var e in f){g.append(e,f[e])}OT.$.post(d,OT._.extend(c||{},{data:g}))};OT.$.post=function(f,e){var g=new XMLHttpRequest(),c=e||{};if(c.success){g.addEventListener("load",c.success,false)}if(c.error){g.addEventListener("error",c.error,false)}if(c.process){g.addEventListener("progress",c.progress,false)}if(c.cancelled){g.addEventListener("abort",c.cancelled,false)}g.open("POST",f,true);if(!c.headers){c.headers={}}for(var d in c.headers){g.setRequestHeader(d,c.headers[d])}g.send(a(c.data))};OT.$.getJSONP=function(d,p){var m=30000,g,i=document.head||document.getElementsByTagName("head")[0],k,h=d,o=OT._.extend(p||{},{callbackParameter:"callback"}),n=function(){if(k){clearTimeout(k);k=null}},c=function(){n();if(g){g.onload=g.onreadystatechange=null;OT.$.removeElement(g);g=undefined}},e=function(){if(g.readyState&&!/loaded|complete/.test(g.readyState)){return}n()},f=function(){c();OT.error("The JSONP request to "+h+" timed out after "+m+"ms.");if(o.error){o.error("The JSONP request to "+d+" timed out after "+m+"ms.",h,o)}},j=function(){return"jsonp_callback_"+(+new Date())};o.callbackName=j();this.jsonp_callbacks[o.callbackName]=function(q){c();if(o.success){o.success(q)}};h+=((/\?/).test(h)?"&":"?")+o.callbackParameter+"="+o.callbackName;g=OT.$.createElement("script",{async:"async",src:h,onload:e,onreadystatechange:e});i.appendChild(g);k=setTimeout(function(){_this._onLoadTimeout()},m)}})(window);(function(c){var e={};e[MediaError.MEDIA_ERR_ABORTED]="The fetching process for the media resource was aborted by the user agent at the user's request.";e[MediaError.MEDIA_ERR_NETWORK]="A network error of some description caused the user agent to stop fetching the media resource, after the resource was established to be usable.";e[MediaError.MEDIA_ERR_DECODE]="An error of some description occurred while decoding the media resource, after the resource was established to be usable.";e[MediaError.MEDIA_ERR_SRC_NOT_SUPPORTED]="The media resource indicated by the src attribute was not suitable. ";OT.VideoOrientation={ROTATED_NORMAL:"OTVideoOrientationRotatedNormal",ROTATED_LEFT:"OTVideoOrientationRotatedLeft",ROTATED_RIGHT:"OTVideoOrientationRotatedRight",ROTATED_UPSIDE_DOWN:"OTVideoOrientationRotatedUpsideDown"};function a(m,o,i,j,h){if(navigator.mozGetUserMedia){m.mozSrcObject=o}else{m.src=c.URL.createObjectURL(o)}m.play();var n=100,g=0,k;function f(){g++;if(o.videoTracks.length===0||m.currentTime>0){i()}else{if(g<n){k=setTimeout(f,100)}else{j("Timed out while waiting for the Video to load the stream. This could be because someone is behind a Firewall or Symmetric NAT.")}}}f()}var b=4/3;function d(h,j,f){if(!j){j=parseInt(OT.$.width(h.parentNode),10)}else{j=parseInt(j,10)}if(!f){f=parseInt(OT.$.height(h.parentNode),10)}else{f=parseInt(f,10)}var m=(j+0)/f,k,g,i,n;if(b==m){g=k="100%"}else{if(m>b){k="100";g=(m/b)*100;n=(g-100)/2;i=0}else{g="100%";k=(b/m)*100;i=(k-100)/2;n=0}}OT.$.css(h,{width:k+"%",height:g+"%",marginLeft:"-"+i+"%",marginTop:"-"+n+"%"})}OT.$.createVideoElement=function(g,h,k,f,j){var i=document.createElement("video");i.addEventListener("error",f,false);i.setAttribute("autoplay","");i.innerHTML=j||"Sorry, Web RTC is not available in your browser";a(i,g,h,k);return i};OT.$.getOrCreateWidgetContainerById=function(i,g){var f=OT.$(i),h=document.createElement("div");if(!f){f=OT.$.createElement("div",{id:i});f.style.backgroundColor="#000000";document.body.appendChild(f)}if(g){width=g.width;height=g.height;if(width){if(typeof(width)=="number"){width=width+"px"}}if(height){if(typeof(height)=="number"){height=height+"px"}}f.style.width=width?width:"264px";f.style.height=height?height:"198px";f.style.overflow="hidden";if(g.mirror===undefined||g.mirror){OT.$.addClass(f,"OT_mirrored")}}if(g.classNames){OT.$.addClass(f,g.classNames)}OT.$.addClass(h,"OT_video-container");h.style.width=f.style.width;h.style.height=f.style.height;f.appendChild(h);d(h,f.offsetWidth,f.offsetHeight);f.videoContainer=h;return f};OT.$.videoElementErrorCodeToStr=function(f){return e[parseInt(f,10)]||"An unknown error occurred."};OT.$.imgDataFromVideo=function(g){var f=OT.$.createElement("canvas",{width:g.videoWidth,height:g.videoHeight,style:{display:"none"}});document.body.appendChild(f);f.getContext("2d").drawImage(g,0,0);var h=f.toDataURL("image/png");OT.$.removeElement(f);return h.replace("data:image/png;base64,","").trim()}})(window);(function(a){OT.$.supportsWebRTC=function(){var c=function(d){return d!==undefined&&typeof(d)==="function"},b=false;if(navigator.webkitGetUserMedia){b=c(webkitRTCPeerConnection)&&!!webkitRTCPeerConnection.prototype.addStream}else{if(navigator.mozGetUserMedia){b=c(mozRTCPeerConnection)}}OT.$.supportsWebRTC=function(){return b};return b};OT.$.getUserMedia=function(h,m,d,c,b){var f=null,g=function(){if(f){clearTimeout(f)}else{b()}},n=function(){f=null;c()},k=function(){g();m.apply(null,arguments)},i=function(e){g();d.apply(null,arguments)};try{if(navigator.getUserMedia){navigator.getUserMedia(h,k,i)}else{if(navigator.webkitGetUserMedia){navigator.webkitGetUserMedia(h,k,i)}else{if(navigator.mozGetUserMedia){navigator.mozGetUserMedia(h,k,i)}else{if(navigator.msGetUserMedia){navigator.msGetUserMedia(h,k,i)}}}}}catch(j){OT.error("Couldn't get UserMedia: "+j.toString());throw j}if(location.protocol.indexOf("https")===-1){setTimeout(n,100)}else{f=setTimeout(n,500)}}})(window);(function(a){OT.Modal=function(e,b,d){var c="        <header>            <h1><%= title %></h1>        </header>        <div class='OT_dialog-body'>            <%= body %>        </div>    ";this.el=OT.$.createElement("section",{className:"OT_root OT_dialog OT_modal"},OT._.template(c,{title:e,body:b}));this.el.style.display="none";document.body.appendChild(this.el);OT.$.centerElement(this.el);OT.$.show(this.el);this.close=function(){OT.$.removeElement(this.el);this.el=null;return this}}})(window);(function(d){var c={1000:"Failed To Load",1004:"Authentication error",1005:"Invalid Session ID",1006:"Connect Failed",1007:"Connect Rejected",1008:"Connect Time-out",1009:"Security Error",1010:"Not Connected",1011:"Invalid Parameter",1012:"Peer-to-peer Stream Play Failed",1013:"Peer-to-peer Connection Failed",1014:"API Response Failure",1500:"Unable to Publish",1510:"Unable to Signal",1520:"Unable to Force Disconnect",1530:"Unable to Force Unpublish",1540:"Unable to record archive",1550:"Unable to play back archive",1560:"Unable to create archive",1570:"Unable to load archive",2000:"Internal Error",2001:"Embed Failed",3000:"Archive load exception",3001:"Archive create exception",3002:"Playback stop exception",3003:"Playback start exception",3004:"Record start exception",3005:"Record stop exception",3006:"Archive load exception",3007:"Session recording in progress",3008:"Archive recording internal failure",4000:"WebSocket Connection Failed",4001:"WebSocket Network Disconnected"};var b;function a(e,k,i,f){var j=c[i],g=f?OT._.clone(f):{};OT.error("TB.exception :: title: "+j+" ("+i+") msg: "+k);if(!g.partnerId){g.partnerId=OT.APIKEY}try{if(!b){b=new OT.Analytics()}b.logError(i,"tb.exception",j,{details:k},g);OT.dispatchEvent(new OT.ExceptionEvent(OT.Event.names.EXCEPTION,k,j,i,e))}catch(h){OT.error("TB.exception :: Failed to dispatch exception - "+h.toString())}}OT.handleJsException=function(h,g,e){if(e&&!e.target){e.target=null}var f,i=e.session;if(i){f={sessionId:i.sessionId};if(i.connected){f.connectionId=i.connection.connectionId}}else{if(e.sessionId){f={sessionId:e.sessionId}}}a(e.target,h,g,f)};OT.exceptionHandler=function(f,j,e,i,g){var h;if(f){h=OT.components[f];if(!h){OT.warn("Could not find the component with component ID "+f)}}a(h,j,i,g)}})(window);(function(a){OT.ConnectionCapabilities=function(d){var b=function(e){e.supportsWebRTC=OT.$.castToBoolean(e.supportsWebRTC);return e};var c=b(d);this.supportsWebRTC=c.supportsWebRTC}})(window);(function(a){OT.Connection=function(e,b,d,c){this.id=this.connectionId=e;this.creationTime=Number(b);this.data=d;this.capabilities=new OT.ConnectionCapabilities(c);this.quality=null;OT.eventing(this)}})(window);(function(a){OT.Stream=function(e,f,b,j,n,k,m,h,d,i,g,o,c,p){this.id=this.streamId=e;this.sessionId=i;this.connection=f;this.name=b;this.data=j;this.type=n||"basic";this.creationTime=Number(k);this.hasAudio=OT.$.castToBoolean(m,true);this.hasVideo=OT.$.castToBoolean(h,true);this.orientation=d;this.peerId=g;this.quality=o;this.videoDimensions={width:c,height:p};OT.eventing(this);this.update=function(q,r){switch(q){case"hasAudio":case"hasVideo":this[q]=OT.$.castToBoolean(r,true);break;case"quality":case"name":case"videoDimensions":case"orientation":this[q]=r}};this.startRecording=function(q){OT.debug("OT.Stream.startRecording");throw new Error("OT.Stream.startRecording: Is not implemented yet.")};this.stopRecording=function(q){OT.debug("OT.Stream.stopRecording");throw new Error("OT.Stream.stopRecording: Is not implemented yet.")}}})(window);(function(a){OT.DOMComponentCleanup=(function(){var e={},d={};var c=function(f){OT.$.on(f,"unload",function(){return b(f)})},b=function(f){if(!d[f]||d[f].length===0){return}d[f].slice().forEach(function(g){g.destroy()});delete d[f]};return{add:function(f){if(f.targetElement&&f.id){var g=f.targetElement.ownerDocument.defaultView;e[f.id]=g;if(!d.hasOwnProperty(g)){d[g]=[];c(g)}d[g].push(f)}},remove:function(g){if(!g.id||!e[g.id]){return}var h=e[g.id],f;if((f=OT._.indexOf(d[h],g))!=-1){d[h].splice(f,1)}}}})()})(window);(function(d){var c=function(g){return function(h){OT.debug("IceCandidateForwarder: Ice Candidate");if(h.candidate){g(OT.WebSocketMessageType.JSEP_CANDIDATE,{candidate:h.candidate})}}};var a=function(){var h=[],g=null;Object.defineProperty(this,"peerConnection",{set:function(i){g=i}});this.process=function(j){var i=new RTCIceCandidate(j.candidate);if(g){g.addIceCandidate(i)}else{h.push(i)}};this.processPending=function(){while(h.length){g.addIceCandidate(h.shift())}}};var b=function(g,m,n,h){var k=function(o){return function(p){if(h){h(o,p)}}},j=function(o){g.setLocalDescription(o,function(){n(o)},k("Error while setting LocalDescription"))},i=function(o){g.createAnswer(j,k("Error while setting createAnswer"))};g.setRemoteDescription(m,i,k("Error while setting RemoteDescription"))};var f=function(g,k,h){var j=function(m){return function(n){if(h){h(m,n)}}},i=function(m){g.setLocalDescription(m,function(){k(m)},j("Error while setting LocalDescription"))};g.createOffer(i,j("Error while creating Offer"))};var e=function(g){if(navigator.webkitGetUserMedia&&typeof(webkitRTCPeerConnection)==="function"){return new webkitRTCPeerConnection(g)}else{if(navigator.mozGetUserMedia&&typeof(mozRTCPeerConnection)==="function"){return new mozRTCPeerConnection(g)}}};OT.rtc.PeerConnection=function(){var m,h=new a(),v,r=[],t,C,q={iceServers:[{url:"stun:stun.l.google.com:19302"}]},x="new",o=true,j=true,w=[];OT.eventing(this);var y=OT._.bind(function(D,E){if(w.length){w[0](D,E)}},this),u=OT._.bind(function(){if(!m){try{OT.debug('Creating peer connection config "'+JSON.stringify(q)+'".');m=e(q)}catch(D){OT.error("Failed to create PeerConnection, exception: "+D.message);return null}h.peerConnection=m;m.onicecandidate=c(y);m.onaddstream=OT._.bind(B,this);m.onremovestream=OT._.bind(n,this);m.onstatechange=OT._.bind(k,this)}return m},this),k=function(D){if(D.target.readyState.toLowerCase()!==x){x=D.target.readyState.toLowerCase();OT.debug("PeerConnection.stateChange: "+x);switch(x){case"new":break;case"open":case"active":case"stable":this.trigger("open");break;case"closed":h.peerConnection=null;m=null;this.trigger("close");break}}},p=function(E,D){return OT._.bind(function(F){g.call(this,"PeerConnection."+E+": "+D+": "+F)},this)},B=function(D){OT.debug("PeerConnection.onRemoteStreamAdded");r.push(D.stream);this.trigger("streamAdded",D.stream)},n=function(D){OT.debug("PeerConnection.onRemoteStreamRemoved");r.remove(D.stream);if(onStreamRemoved){onStreamRemoved(D.stream)}},A=function(E,D){y(E,{sdp:D})},s=function(F){var E=new RTCSessionDescription(F.sdp),D=function(H){A(OT.WebSocketMessageType.JSEP_ANSWER,H)},G=function(I,H){g("PeerConnection.offerProcessor "+I+": "+H)};u();_remoteDescriptionType=E.type;_remoteDescription=E;b(m,E,D,G)},z=function(D){if(!D.sdp){OT.error("PeerConnection.processMessage: Weird message, no SDP.");return}C=new RTCSessionDescription(D.sdp);_remoteDescriptionType=C.type;_remoteDescription=C;m.setRemoteDescription(C);h.processPending()},i=function(D){OT.debug("PeerConnection.processSubscribe: Sending offer to subscriber.");u();f(m,function(E){t=E;A(OT.WebSocketMessageType.JSEP_OFFER,t)},function(F,E){g("PeerConnection.suscribeProcessor "+F+": "+E)})},g=OT._.bind(function(D){OT.error(D);this.trigger("error",D)},this);this.addLocalStream=function(D){v=D;u();if(v.audioTracks.length>0){v.audioTracks[0].enabled=o}if(v.videoTracks.length>0){v.videoTracks[0].enabled=j}m.addStream(D)};this.disconnect=function(){if(m){m=null}r=[]};this.processMessage=function(D,E){OT.debug("PeerConnection.processMessage: Received "+D+" from "+E.fromAddress);OT.debug(E);switch(D){case OT.WebSocketMessageType.JSEP_SUBSCRIBE:i.call(this,E);break;case OT.WebSocketMessageType.JSEP_OFFER:s.call(this,E);break;case OT.WebSocketMessageType.JSEP_ANSWER:z.call(this,E);break;case OT.WebSocketMessageType.JSEP_CANDIDATE:h.process(E);break;default:OT.debug("PeerConnection.processMessage: Received an unexpected message of type "+D+" from "+E.fromAddress+": "+JSON.stringify(E))}return this};this.audioEnabled=function(D){o=D;if(v){if(v.audioTracks.length>0){v.audioTracks[0].enabled=o}}};this.videoEnabled=function(D){j=D;if(v){if(v.videoTracks.length>0){v.videoTracks[0].enabled=j}}};this.registerMessageDelegate=function(D){w.push(D)};this.unregisterMessageDelegate=function(D){OT._.without(w,D)};Object.defineProperty(this,"remoteStreams",{get:function(){return r}})}})(window);(function(b){var a={};OT.rtc.PeerConnections={add:function(f,e){var c=f.id+"_"+e.id,d=a[c];if(!d){d=a[c]={count:0,pc:new OT.rtc.PeerConnection(f,e)}}d.count+=1;return d.pc},remove:function(f,e){var c=f.id+"_"+e.id,d=a[c];if(d){d.count-=1;if(d.count===0){d.pc.disconnect();delete a[c]}}}}})(window);(function(a){OT.rtc.PublisherPeerConnection=function(j,d,f,i){var h;var b=function(){this.trigger("connected",this)},c=function(){this.trigger("disconnected",this);this.destroy()},g=function(k){this.trigger("error",null,k,this);this.destroy()},e=function(k,m){d.sendJSEPMessage(j,k,OT._.extend(m,{streamId:f.id}))};OT.eventing(this);this.destroy=function(){if(h){OT.rtc.PeerConnections.remove(j,f)}h=null};this.processMessage=function(k,m){h.processMessage(k,m)};this.publishAudio=function(k){h.audioEnabled(k)};this.publishVideo=function(k){h.videoEnabled(k)};h=OT.rtc.PeerConnections.add(j,f);h.on({open:OT._.bind(b,this),close:OT._.bind(c,this),error:OT._.bind(g,this)});h.registerMessageDelegate(e);h.addLocalStream(i);Object.defineProperty(this,"remoteConnection",{value:j})}})(window);(function(a){OT.rtc.SubscriberPeerConnection=function(k,c,f){var g,n,t,d=false;var p=function(){d=true;if(n){this.trigger("connected",this)}},u=function(){d=false;this.trigger("disconnected",this);this.destroy()},e=function(i){n=i;t=OT.$.createVideoElement(i,OT._.bind(m,this),OT._.bind(o,this),OT._.bind(q,this));this.trigger("remoteStreamAdded",n,t,this)},s=function(i){n=null;this.trigger("remoteStreamRemoved",i,this)},m=function(){if(d){this.trigger("connected",this)}},o=function(i){this.trigger("error",OT.ExceptionCodes.P2P_CONNECTION_FAILED,i,this)},q=function(i){var v="There was an unexpected problem with the Video Stream: "+OT.$.videoElementErrorCodeToStr(i.target.error.code);this.trigger("error",null,v,this)},b=function(i){d=false;this.trigger("error",null,i,this)},j=function(i,v){c.sendJSEPMessage(k,i,OT._.extend(v,{streamId:f.id}))};OT.eventing(this);this.destroy=function(){if(c&&c.connected&&f){c.sendJSEPMessage(f.connection,OT.WebSocketMessageType.JSEP_UNSUBSCRIBE,{streamId:f.id})}if(g){OT.rtc.PeerConnections.remove(k,f)}n=null;d=false;g=null;if(t){OT.$.removeElement(t)}};this.processMessage=function(i,v){g.processMessage(i,v)};this.subscribeToAudio=function(i){};this.subscribeToVideo=function(i){};g=OT.rtc.PeerConnections.add(k,f);g.on({open:OT._.bind(p,this),close:OT._.bind(u,this),streamAdded:OT._.bind(e,this),streamRemoved:OT._.bind(s,this),error:OT._.bind(b,this)});g.registerMessageDelegate(j);if(g.remoteStreams.length>0){for(var r=0,h=g.remoteStreams.length;r<h;++r){e.call(this,g.remoteStreams[r])}}else{c.sendJSEPMessage(k,OT.WebSocketMessageType.JSEP_SUBSCRIBE,{streamId:f.id})}}})(window);(function(a){OT.Chrome=function(d){var e=false,c={},b=function(f,g){g.parent=this;g.appendTo(d.parent);c[f]=g;Object.defineProperty(this,f,{get:function(){return c[f]}})};if(!d.parent){return}OT.eventing(this);this.destroy=function(){this.hide();for(var f in c){c[f].destroy()}};this.show=function(){e=true;for(var f in c){c[f].show()}};this.hide=function(){e=false;for(var f in c){c[f].hide()}};this.set=function(g,h){if(typeof(g)==="string"&&h){b.call(this,g,h)}else{for(var f in g){if(g.hasOwnProperty(f)){b.call(this,f,g[f])}}}return this}}})(window);(function(a){if(!OT.Chrome.Behaviour){OT.Chrome.Behaviour={}}OT.Chrome.Behaviour.Widget=function(f,c){var b=c||{},e,d;f.setDisplayMode=function(h){var g=h||"auto";if(e===g){return}OT.$.removeClass(this.domElement,"OT_mode-"+e);OT.$.addClass(this.domElement,"OT_mode-"+g);d=e;e=g};f.show=function(){this.setDisplayMode(d);if(b.onShow){b.onShow()}return this};f.hide=function(){this.setDisplayMode("off");if(b.onHide){b.onHide()}return this};f.destroy=function(){if(b.onDestroy){b.onDestroy(this.domElement)}if(this.domElement){OT.$.removeElement(this.domElement)}return f};f.appendTo=function(g){this.domElement=OT.$.createElement(b.nodeName||"div",b.htmlAttributes,b.htmlContent);if(b.onCreate){b.onCreate(this.domElement)}f.setDisplayMode("on");g.appendChild(this.domElement);setTimeout(function(){f.setDisplayMode(b.mode)},2000);return f}}})(window);(function(a){OT.Chrome.NamePanel=function(c){var b=c.name;if(!b||b.trim().length===""){b=null;c.mode="off"}var d;this.__defineGetter__("domElement",function(){return d});this.__defineSetter__("domElement",function(e){d=e});OT.Chrome.Behaviour.Widget(this,{mode:c.mode,nodeName:"h1",htmlContent:b,htmlAttributes:{className:"OT_name"}});this.__defineSetter__("name",OT._.bind(function(e){if(!b){this.setDisplayMode("auto")}b=e;d.innerHTML=b},this))}})(window);(function(a){OT.Chrome.MuteButton=function(d){var f,c=d.muted||false;var g;this.__defineGetter__("domElement",function(){return g});this.__defineSetter__("domElement",function(i){g=i});var e=function(i){f=OT._.bind(h,this);i.addEventListener("click",f,false)},b=function(i){f=null;i.removeEventListener("click",f,false)},h=function(i){c=!c;if(c){OT.$.addClass(g,"OT_active");this.parent.trigger("muted",this)}else{OT.$.removeClass(g,"OT_active");this.parent.trigger("unmuted",this)}return false};OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mute"},onCreate:OT._.bind(e,this),onDestroy:OT._.bind(b,this)})}})(window);(function(a){OT.Chrome.MicVolume=function(d){var f,c=d.muted||false;var g;this.__defineGetter__("domElement",function(){return g});this.__defineSetter__("domElement",function(i){g=i});var e=function(i){f=OT._.bind(h,this);i.addEventListener("click",f,false)},b=function(i){f=null;i.removeEventListener("click",f,false)},h=function(i){c=!c;if(c){OT.$.addClass(g,"active");this.parent.trigger("muted",this)}else{OT.$.removeClass(g,"active");this.parent.trigger("unmuted",this)}return false};OT.Chrome.Behaviour.Widget(this,{mode:d.mode,nodeName:"button",htmlContent:"Mute",htmlAttributes:{className:"OT_mic-volume"},onCreate:OT._.bind(e,this),onDestroy:OT._.bind(b,this)})}})(window);(function(a){OT.Chrome.SettingsPanelButton=function(c){var e;var d=function(h){e=OT._.bind(g,this);h.addEventListener("click",e,false)},b=function(h){e=null;h.removeEventListener("click",e,false)},g=function(h){this.parent.trigger("SettingsPanel:open",this);return false};var f;this.__defineGetter__("domElement",function(){return f});this.__defineSetter__("domElement",function(h){f=h});OT.Chrome.Behaviour.Widget(this,{mode:c.mode,nodeName:"button",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(d,this),onDestroy:OT._.bind(b,this)})}})(window);(function(a){OT.Chrome.SettingsPanel=function(e){if(!e.stream){return}var d=e.stream;var f;this.__defineGetter__("domElement",function(){return f});this.__defineSetter__("domElement",function(h){f=h});var c=function(){var j=d.videoTracks.length?d.videoTracks[0].label:"None",i=d.audioTracks.length?d.audioTracks[0].label:"None";f.innerHTML="<dl>                                        <dt>Cam</dt>                                        <dd>"+j+"</dd>                                        <dt>Mic</dt>                                        <dd>"+i+"</dd>                                    </dl>";var h=OT.$.createButton("Close",{className:"OT_close"},{click:OT._.bind(b,this)});f.appendChild(h)},g=function(){c.call(this)},b=function(){this.parent.trigger("SettingsPanel:close",this);return false};OT.Chrome.Behaviour.Widget(this,{mode:e.mode,nodeName:"section",htmlContent:"Settings",htmlAttributes:{className:"OT_settings-panel"},onCreate:OT._.bind(c,this),onShow:OT._.bind(g,this)})}})(window);(function(a){OT.Chrome.OpenTokButton=function(b){if(!b||!b.infoHref){return false}var c;this.__defineGetter__("domElement",function(){return c});this.__defineSetter__("domElement",function(d){c=d});OT.Chrome.Behaviour.Widget(this,{mode:b?b.mode:null,nodeName:"a",htmlContent:"OpenTok",htmlAttributes:{className:"OT_opentok",title:"more info",href:b.infoHref,target:"_blank"}});this.__defineSetter__("infoHref",function(d){b.infoHref=d;c.setAttribute("href",d)})}})(window);(function(b){OT.rtc.StylableComponent=function(f,d){if(!f.trigger){throw new Error("OT.rtc.StylableComponent is dependent on the mixin OT.eventing. Ensure that this is included in the object before StylableComponent.")}var e=function(h,i,g){if(g){f.trigger("styleValueChanged",h,i,g)}else{f.trigger("styleValueChanged",h,i)}};var c=new a(d,e);f.getStyle=function(g){return c.get(g)};f.setStyle=function(i,h,g){if(typeof(i)!=="string"){c.setAll(i,g)}else{c.set(i,h)}return this}};var a=function(d,f){var e=["showMicButton","showSpeakerButton","showSettingsButton","showCameraToggleButton","nameDisplayMode","buttonDisplayMode","showSaveButton","showRecordButton","showRecordStopButton","showReRecordButton","showPauseButton","showPlayButton","showPlayStopButton","showStopButton","backgroundImageURI","showControlPanel","showRecordCounter","showPlayCounter","showControlBar","showPreviewTime"],i={buttonDisplayMode:["auto","off","on"],nameDisplayMode:["auto","off","on"],showSettingsButton:[true,false],showMicButton:[true,false],showCameraToggleButton:[true,false],showSaveButton:[true,false],backgroundImageURI:null,showControlBar:[true,false],showPlayCounter:[true,false],showRecordCounter:[true,false],showPreviewTime:[true,false]},c={},g=function(j,k){return j==="backgroundImageURI"||(i.hasOwnProperty(j)&&OT._.include(i[j],k))},h=function(j){switch(j){case"true":return true;case"false":return false;default:return j}};this.getAll=function(){var k=OT._.clone(c);for(var j in k){if(e.indexOf(j)<0){delete k[j]}}return k};this.get=function(j){if(j){return c[j]}return this.getAll()};this.setAll=function(n,j){var k,o;for(var m in n){o=h(n[m]);if(g(m,o)){k=c[m];if(o!==k){c[m]=o;if(!j){f(m,o,k)}}}else{OT.warn("Style.setAll::Invalid style property passed "+m+" : "+o)}}return this};this.set=function(k,m){OT.debug("Publisher.setStyle: "+k.toString());var n=h(m),j;if(!g(k,n)){OT.warn("Style.set::Invalid style property passed "+k+" : "+n);return this}j=c[k];if(n!==j){c[k]=n;f(k,m,j)}return this};if(d){this.setAll(d,true)}}})(window);(function(a){OT.Microphone=function(c,e){var b=c.audioTracks.length?!c.audioTracks[0].enabled:false,d=50;Object.defineProperty(this,"muted",{get:function(){return b},set:function(f){if(b===f){return}b=f;if(c.audioTracks.length){c.audioTracks[0].enabled=!b}}});Object.defineProperty(this,"gain",{get:function(){return d},set:function(f){OT.warn("OT.Microphone.gain IS NOT YET IMPLEMENTED");d=f}})}})(window);(function(a){OT.rtc.Publisher=function(){if(!OT.checkSystemRequirements()){OT.upgradeSystemRequirements();return}var i=OT.rtc.Publisher.nextId(),z,m,u,s,q,E,o={},e=false,v,h,d=false,D,F,w=new OT.Analytics(),g;OT.eventing(this);OT.rtc.StylableComponent(this,{showMicButton:true,showSettingsButton:true,showCameraToggleButton:true,nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var f=function(I,G,H,J){w.logEvent({action:I,variation:G,payload_type:H,payload:J,session_id:E?E.sessionId:null,connection_id:E&&E.connected?E.connection.connectionId:null,partner_id:E?E.apiKey:OT.APIKEY,widget_id:i})},b=function(){OT.debug("OT.rtc.Publisher.onLoaded");f("publish","Success","streamType","WebRTC");OT.$.removeClass(m,"loading");t.call(this);e=true;this.trigger("loaded",this)},c=function(G){f("publish","Failure","reason","Publisher PeerConnection Error: "+G);OT.handleJsException("Publisher PeerConnection Error: "+G,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:E,target:this})},B=function(G){OT.debug("OT.rtc.Publisher.onStreamAvailable");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_ALLOWED,false));q=G;u=OT.$.createVideoElement(q,OT._.bind(b,this),OT._.bind(c,this),OT._.bind(n,this));m.videoContainer.appendChild(u);OT.DOMComponentCleanup.add(this,u);D=new OT.Microphone(q,u)},y=function(G){switch(G.code){case 1:OT.error("OT.rtc.Publisher.onStreamAvailableError Permission Denied");f("publish","Failure","reason","Publisher Access Denied: Permission Denied ("+G.code+")");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DENIED,false));break;default:OT.error("OT.rtc.Publisher.onStreamAvailableError Unknown Error");f("publish","Failure","reason","Publisher failed to access camera/mic: unknown reason ("+G.code+")");OT.handleJsException("Publisher failed to access camera/mic: "+G.code,2000,{session:E,target:this})}},k=function(){f("accessDialog","Opened","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_OPENED,false))},r=function(){f("accessDialog","Closed","","");this.dispatchEvent(new OT.Event(OT.Event.names.ACCESS_DIALOG_CLOSED,false))},n=function(G){OT.error("OT.rtc.Publisher.onVideoError");f("stream",null,"reason","Publisher while playing stream: "+G.code);OT.handleJsException("Publisher error playing stream: "+G.code,2000,{session:E,target:this})},j=function(){OT.debug("OT.rtc.Subscriber has been disconnected from the Publisher's PeerConnection")},x=function(H,I,G){f("publish","Failure","reason","Publisher PeerConnection with connection "+G.remoteConnection.id+" failed: "+I);OT.handleJsException("Publisher PeerConnection Error: "+I,2000,{session:E,target:this})},A=function(H){var G=o[H.id];if(!G){G=o[H.id]=new OT.rtc.PublisherPeerConnection(H,E,s,q);G.on({disconnected:OT._.bind(j,this),error:OT._.bind(x,this)})}return G},C=function(H){if(H===false){return"off"}var G=this.getStyle("buttonDisplayMode");if(G===false){return"on"}return G},p=function(H,I,G){if(!F){return}switch(H){case"nameDisplayMode":F.name.setDisplayMode(I);break;case"buttonDisplayMode":case"showMicButton":case"showSettingsButton":}},t=function(){F=new OT.Chrome({parent:m}).set({name:new OT.Chrome.NamePanel({name:v.name,mode:this.getStyle("nameDisplayMode")}),muteButton:new OT.Chrome.MuteButton({muted:v.publishAudio===false,mode:C.call(this,this.getStyle("showMicButton"))}),opentokButton:new OT.Chrome.OpenTokButton({infoHref:OT.$.moreInfoLink(E)})}).on({muted:function(){D.muted=true},unmuted:function(){D.muted=false}})};this.publish=function(H,G){OT.debug("OT.rtc.Publisher: publish");if(z){this.unpublish()}z=H||uuid();v=OT._.defaults(G||{},{publishAudio:true,publishVideo:true,mirror:true});if(v.style){this.setStyle(v.style,null,true)}if(v.name){v.name=v.name.toString()}v.classNames="OT_root OT_publisher OT_loading";OT.onLoad(OT._.bind(function(){m=OT.$.getOrCreateWidgetContainerById(z,v);OT.$.getUserMedia({audio:v.publishAudio,video:v.publishVideo},OT._.bind(B,this),OT._.bind(y,this),OT._.bind(k,this),OT._.bind(r,this))},this));return this};this.publishAudio=function(G){v.publishAudio=G;if(E&&s){E.sendMessage(OT.WebSocketMessage.modifyStream(s.streamId,"hasAudio",G))}for(var H in o){if(o.hasOwnProperty(H)){o[H].publishAudio(G)}}};this.publishVideo=function(G){v.publishVideo=G;if(E&&s){E.sendMessage(OT.WebSocketMessage.modifyStream(s.streamId,"hasVideo",G))}for(var H in o){if(o.hasOwnProperty(H)){o[H].publishVideo(G)}}};this.recordQOS=function(){w.logQOS({widget_type:"Publisher",stream_type:"WebRTC",sessionId:E?E.sessionId:null,connectionId:E&&E.connected?E.connection.connectionId:null,partnerId:E?E.apiKey:OT.APIKEY,streamId:s?s.id:null,widgetId:i,version:OT.BUILD_PROPERTIES.version,media_server_name:E.sessionInfo.mediaServer,duration:new Date().getTime()-h.getTime()})};this.destroy=function(){OT.DOMComponentCleanup.remove(this);if(F){F.destroy();F=null}this.disconnect();D=null;if(q){q.stop();q=null}if(m){OT.$.removeElement(m);m=null;u=null}if(this.session){this._.unpublishFromSession(this.session)}d=false;if(g){clearInterval(g)}z=null;s=null;e=false;E=null;_properties=null;this.trigger("destroyed",this);return this};this.disconnect=function(){for(var G in o){this.cleanupSubscriber(G)}};this.cleanupSubscriber=function(H){var G=o[H];if(G){G.destroy();delete o[H];f("disconnect","PeerConnection","subscriberConnection",H)}};this.processMessage=function(H,J,I){OT.debug("OT.rtc.Publisher.processMessage: Received "+H+" from "+J.id);OT.debug(I);switch(H){case OT.WebSocketMessageType.JSEP_UNSUBSCRIBE:this.cleanupSubscriber(J.id);break;default:var G=A.call(this,J);G.processMessage(H,I)}};this.getImgData=function(){if(!e){OT.error("OT.rtc.Publisher.getImgData: Cannot getImgData before the Publisher is publishing.");return null}return OT.$.imgDataFromVideo(u)};this._={publishToSession:OT._.bind(function(H){this.session=H;if(F){F.opentokButton.infoHref=OT.$.moreInfoLink(E)}var G=function(){H.sendMessage(OT.WebSocketMessage.createStream(this.guid,v&&v.name?v.name:"",OT.VideoOrientation.ROTATED_NORMAL,640,480,v.publishAudio,v.publishVideo,this.session.sessionInfo.p2pEnabled))};if(e){G.call(this)}else{this.on("loaded",OT._.bind(G,this))}f("publish","Attempt","streamType","WebRTC");return this},this),unpublishFromSession:OT._.bind(function(G){if(!this.session||G.id!==this.session.id){OT.warn("The publisher "+this.guid+" is trying to unpublish from a session "+G.id+" it is not attached to");return this}if(G.connected&&this.stream){G.sendMessage(OT.WebSocketMessage.destroyStream(this.stream.id))}this.disconnect();this.session=null;f("unpublish","Success","sessionId",G.id);return this},this),publishedToSessionHandler:OT._.bind(function(){h=new Date();d=true;g=setInterval(this.recordQOS,30000)},this)};this.detectDevices=function(){OT.warn("Fixme: Haven't implemented detectDevices")};this.detectMicActivity=function(){OT.warn("Fixme: Haven't implemented detectMicActivity")};this.getEchoCancellationMode=function(){OT.warn("Fixme: Haven't implemented getEchoCancellationMode");return"fullDuplex"};this.setMicrophoneGain=function(G){OT.warn("Fixme: Haven't implemented setMicrophoneGain")};this.getMicrophoneGain=function(){OT.warn("Fixme: Haven't implemented getMicrophoneGain");return 0.5};this.setCamera=function(G){OT.warn("Fixme: Haven't implemented setCamera")};this.setMicrophone=function(G){OT.warn("Fixme: Haven't implemented setMicrophone")};this.on("styleValueChanged",OT._.bind(p,this));this.__defineGetter__("id",function(){return z});this.__defineGetter__("guid",function(){return i});this.__defineGetter__("stream",function(){return s});this.__defineSetter__("stream",function(G){s=G});this.__defineGetter__("streamId",function(){if(!s){return null}return s.id});this.__defineGetter__("targetElement",function(){return u});this.__defineGetter__("domId",function(){return z});this.__defineGetter__("session",function(){return E});this.__defineSetter__("session",function(G){E=G});this.__defineGetter__("isWebRTC",function(){return true})};OT.rtc.Publisher.nextId=uuid})(window);(function(a){OT.rtc.Subscriber=function(j,g){var c=uuid(),x=j||c,k,q,A,o,w,i,z=g.session,d=false,v,f,r=OT._.clone(g),s=new OT.Analytics();if(!z){OT.handleJsException("Subscriber must be passed a session option",2000,{session:z,target:this});return}OT.eventing(this);OT.rtc.StylableComponent(this,{nameDisplayMode:"auto",buttonDisplayMode:"auto",backgroundImageURI:null});var e=function(D,B,C,E){s.logEvent({action:D,variation:B,payload_type:C,payload:E,stream_id:o?o.id:null,session_id:z?z.sessionId:null,connection_id:z&&z.connected?z.connection.connectionId:null,partner_id:z&&z.connected?z.sessionInfo.partnerId:null,widget_id:c})},b=function(){if(d){return}OT.debug("OT.rtc.Subscriber.onLoaded");d=true;v=new Date();f=setInterval(this.recordQOS,30000);OT.$.removeClass(k,"loading");p.call(this);this.trigger("loaded",this);e("subscribe","Success","streamId",o.id)},u=function(){OT.debug("OT.rtc.Subscriber has been disconnected from the Publisher's PeerConnection");d=false},t=function(B,C){this.disconnect();e("subscribe","Failure","reason","Subscriber PeerConnection Error: "+C);OT.handleJsException("Subscriber PeerConnection Error: "+C,OT.ExceptionCodes.P2P_CONNECTION_FAILED,{session:z,target:this});n.call(this,C)},y=function(C,B){OT.debug("OT.rtc.Subscriber.onRemoteStreamAdded");w=C;q=B;k.videoContainer.appendChild(q);OT.DOMComponentCleanup.add(this,q);this.streamOrientationDidChange(o.orientation.width,o.orientation.height,o.orientation.videoOrientation);this.trigger("streamAdded",this)},h=function(B){OT.debug("OT.rtc.Subscriber.onStreamRemoved");w=null;if(q){OT.$.removeElement(q);q=null}this.trigger("streamRemoved",this)},m=function(C,D,B){if(!A){return}switch(C){case"nameDisplayMode":A.name.setDisplayMode(D);break;case"buttonDisplayMode":}},p=function(){A=new OT.Chrome({parent:k}).set({name:new OT.Chrome.NamePanel({name:r.name,mode:this.getStyle("nameDisplayMode")}),opentokButton:new OT.Chrome.OpenTokButton({infoHref:OT.$.moreInfoLink(z)})}).on({muted:function(){},unmuted:function(){}})},n=function(B){if(k){k.innerHTML="<p>"+B+"<p>"}OT.$.addClass(k,"OT_subscriber_error")};this.recordQOS=function(){if(d&&z&&z.connected){s.logQOS({widget_type:"Subscriber",stream_type:"WebRTC",session_id:z.sessionId,connectionId:z.connection.connectionId,media_server_name:z.sessionInfo.mediaServer,partner_id:z.apiKey,stream_id:o.id,widget_id:c,version:OT.BUILD_PROPERTIES.version,duration:new Date().getTime()-v.getTime()})}};this.subscribe=function(B){OT.debug("OT.rtc.Subscriber: subscribe to "+B.id);if(d){OT.error("OT.rtc.Subscriber.Subscribe: Cannot subscribe, already subscribing.");return false}if(!B){OT.error("OT.rtc.Subscriber: No stream parameter.");return false}if(o){OT.error("OT.rtc.Subscriber: Already subscribed");return false}o=B;x=j||uuid();r.name=o.name;r.classNames="OT_root OT_subscriber OT_loading";if(r.style){this.setStyle(r.style,null,true)}k=OT.$.getOrCreateWidgetContainerById(x,r);i=new OT.rtc.SubscriberPeerConnection(o.connection,z,o);i.on({connected:OT._.bind(b,this),disconnected:OT._.bind(u,this),error:OT._.bind(t,this),remoteStreamAdded:OT._.bind(y,this),remoteStreamRemoved:OT._.bind(h,this)});e("subscribe","Attempt","streamId",o.id);return this};this.destroy=function(){OT.DOMComponentCleanup.remove(this);this.disconnect();if(A){A.destroy();A=null}if(k){OT.$.removeElement(k);k=null;q=null}e("unsubscribe",null,"streamId",o.id);x=null;o=null;clearInterval(f);z=null;r=null;this.trigger("destroyed",this);return this};this.disconnect=function(){d=false;if(i){i.destroy();i=null;e("disconnect","PeerConnection","streamId",o.id)}};this.processMessage=function(B,D,C){OT.debug("OT.rtc.Subscriber.processMessage: Received "+B+" message from "+D.id);OT.debug(C);if(i){i.processMessage(B,C)}};this.getImgData=function(){if(!this.subscribing){OT.error("OT.rtc.Subscriber.getImgData: Cannot getImgData before the Subscriber is subscribing.");return null}return OT.$.imgDataFromVideo(q)};this.setAudioVolume=function(B){OT.warn("Fixme: Haven't implemented setAudioVolume")};this.getAudioVolume=function(){OT.warn("Fixme: Haven't implemented getAudioVolume");return 0.5};this.subscribeToAudio=function(B){for(var C in _peerConnections){if(_peerConnections.hasOwnProperty(C)){_peerConnections[C].publishAudio(B)}}};this.subscribeToVideo=function(B){OT.warn("Fixme: Haven't implemented subscribeToVideo")};this.streamOrientationDidChange=function(D,B,C){if(C==OT.VideoOrientation.ROTATED_NORMAL){q.style.webkitTransform="rotate(0deg)"}else{if(C==OT.VideoOrientation.ROTATED_LEFT){q.style.webkitTransform="rotate(90deg)"}else{if(C==OT.VideoOrientation.ROTATED_RIGHT){q.style.webkitTransform="rotate(-90deg)"}else{if(C==OT.VideoOrientation.ROTATED_UPSIDE_DOWN){q.style.webkitTransform="rotate(180deg)"}else{q.style.webkitTransform="rotate(0deg)"}}}}};this.on("styleValueChanged",OT._.bind(m,this));this.__defineGetter__("id",function(){return x});this.__defineGetter__("stream",function(){return o});this.__defineGetter__("targetElement",function(){return q});this.__defineGetter__("subscribing",function(){return d});this.__defineGetter__("isWebRTC",function(){return true})}})(window);(function(a){OT.TokenPermissions=function(e){var c=null;this.sessionId=null;this.partnerId=null;this.connectionData="";this.validToken=true;this.capabilities={forceUnpublish:0,playback:0,publish:0,publishH264:0,record:0,subscribe:0};if(e.documentElement&&e.documentElement.firstElementChild!==null){c=e.documentElement.firstElementChild}OT.log("ValidateTokenResponse:");OT.log(e);if(c!==null&&c.localName.toLowerCase()=="token"){var d=c.firstElementChild;do{switch(d.localName){case"session_id":this.sessionId=d.textContent;break;case"partner_id":this.partnerId=d.textContent;break;case"permissions":var b=d.firstElementChild;do{switch(b.tagName){case"forceunpublish":this.capabilities.forceUnpublish=1;break;case"forcedisconnect":this.capabilities.forceDisconnect=1;break;case"playback":this.capabilities.playback=1;break;case"publish":this.capabilities.publish=1;break;case"publishH264":this.capabilities.publishH264=1;break;case"record":this.capabilities.record=1;break;case"subscribe":this.capabilities.subscribe=1;break}}while(b=b.nextElementSibling);OT.debug("Capabilities:"+JSON.stringify(this.capabilities));break;case"connection_data":this.connectionData=d.textContent;OT.log("ConnectionData: "+this.connectionData);break;case"invalid":OT.error("Token Invalid "+d.firstChild.textContent);this.validToken=false;break;default:break}}while(d=d.nextElementSibling)}else{this.validToken=false}}})(window);(function(a){var b={};b["404"]=OT.ExceptionCodes.INVALID_SESSION_ID;b["403"]=OT.ExceptionCodes.AUTHENTICATION_ERROR;OT.SessionInfo=function(h){var c=null;this.sessionId=null;this.partnerId=null;this.sessionStatus=null;this.p2pEnabled=false;this.mediaServer=null;this.p2pServer=null;this.messagingServer=null;this.validSession=true;OT.log("SessionInfo Response:");OT.log(h);if(h&&h.documentElement&&h.documentElement.firstElementChild!==null){c=h.documentElement.firstElementChild}if(c!==null&&c.localName.toLowerCase()==="session"){var d=c.firstElementChild;do{switch(d.localName){case"session_id":this.sessionId=d.textContent;break;case"partner_id":this.partnerId=d.textContent;break;case"session_status":this.sessionStatus=d.textContent;break;case"p2p_server_url":this.p2pServer=d.textContent;break;case"media_server_hostname":this.mediaServer=d.textContent;break;case"messaging_server_url":this.messagingServer=d.textContent;break;case"properties":var g=d.firstElementChild;if(g!=null){do{switch(g.localName){case"p2p":if(g.firstElementChild!=null){this.p2pEnabled=(g.firstElementChild.textContent=="enabled")}break;default:break}}while(g=g.nextElementSibling)}break;case"error":var f=d.attributes.getNamedItem("code").nodeValue,e=d.firstElementChild.attributes.getNamedItem("message").nodeValue;OT.error("SessionInfo Error "+f+": "+e);OT.handleJsException("SessionInfo Error "+f+": "+e,b[f],{sessionId:this.sessionId});break;default:break}}while(d=d.nextElementSibling)}else{this.validSession=false;this.errorMessage="";if(c&&c.localName.toLowerCase()==="error"&&c.firstElementChild){this.errorMessage=c.firstElementChild.nodeName+" "+c.firstElementChild.getAttribute("message")}}}})(window);(function(a){OT.Capabilities=function(b){this.publish=OT._.contains(b,"publish")?1:0;this.subscribe=OT._.contains(b,"subscribe")?1:0;this.forceUnpublish=OT._.contains(b,"forceunpublish")?1:0;this.forceDisconnect=OT._.contains(b,"forcedisconnect")?1:0;this.supportsWebRTC=OT.$.supportsWebRTC()?1:0}})(window);(function(c){var a=[],b=false;OT.Analytics=function(){var f=OT.BUILD_PROPERTIES.loggingURL+"/logging/ClientEvent",g=OT.BUILD_PROPERTIES.loggingURL+"/logging/ClientQos",h={},d={payloadType:"payload_type",streamId:"stream_id",sessionId:"session_id",connectionId:"connection_id",widgetType:"widget_type",widgetId:"widget_id"},i=function(o,m,p,n){OT.$.post(m?g:f,{success:p,error:n,data:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}})},j=function(){if(!b&&a.length>0){b=true;var n=a[0];var m=function(){a.shift();b=false;j()};if(n){i(n.data,n.isQos,function(){n.onComplete();setTimeout(m,50)},function(){OT.debug("Failed to send ClientEvent, moving on to the next item.");setTimeout(m,50)})}}},e=function(n,o,m){a.push({data:n,onComplete:o,isQos:m});j()},k=function(p,o,q){if(!q){return false}var m=[q,o,p].join("_"),n=100;if(n===null||n===undefined){return false}return(h[m]||0)<=n};this.logError=function(r,p,q,o,n){if(!n){n={}}var t=n.partnerId;if(OT.Config.get("exceptionLogging","enabled",t)!==true){return}if(k(r,p,t)){return}var m=[t,p,r].join("_"),s=this.escapePayload(OT._.extend(o||{},{message:s,userAgent:navigator.userAgent}));h[m]=typeof(h[m])!=="undefined"?h[m]+1:1;return this.logEvent(OT._.extend(n,{action:p+"."+r,payloadType:s[0],payload:s[1]}))};this.logEvent=function(m){var q=m.partnerId;if(!m){m={}}var o=OT._.extend({variation:"",guid:m.connectionId,widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:q,source:c.location.href,section:"",build:""},m),p=function(){};for(var n in d){if(d.hasOwnProperty(n)&&o[n]){o[d[n]]=o[n];delete o[n]}}e(o,p,false)};this.logQOS=function(m){var q=m.partnerId;if(!m){m={}}var o=OT._.extend({guid:m.connectionId,widget_id:"",session_id:"",connection_id:"",stream_id:"",partner_id:q,source:c.location.href,build:"",duration:0},m),p=function(){};for(var n in d){if(d.hasOwnProperty(n)&&o[n]){o[d[n]]=o[n];delete o[n]}}e(o,p,true)};this.escapePayload=function(p){var o=[],m=[];for(var n in p){if(p.hasOwnProperty(n)&&p[n]!==null&&p[n]!==undefined){o.push(p[n]?p[n].toString().replace("|","\\|"):"");m.push(n.toString().replace("|","\\|"))}}return[m.join("|"),o.join("|")]}}})(window);(function(a){OT.Session=function(G){if(!OT.checkSystemRequirements()){OT.upgradeSystemRequirements();return}var e,g=false,E=false,m,z={},M={},T={},O={},L,n,r=G,R=false,f,d={},x=uuid(),V={},p=new OT.Analytics();OT.eventing(this);function u(X){for(var Y in M){var W=M[Y];if(X===W.streamId){return W}}return null}function A(W){if(!W.connection||!z[W.connection.connectionId]){OT.warn("Received a stream for a connection that doesn't exist");OT.debug(W);return false}return true}function q(W){return O[W]}function S(W){W.forEach(J)}function J(W){O[W.id]=W}function k(W){delete O[W]}function o(Z,X,Y){var aa=q(Z),W=aa[X];aa.update(X,Y);return W}var w=function(W){g=true;E=false;m=W.connectionId;d=new OT.Capabilities(W.permissions);W.connections.forEach(function(X){z[X.connectionId]=X});W.streams=OT._.filter(W.streams,function(X){return A(X)});S(W.streams);this.dispatchEvent(new OT.SessionConnectEvent(OT.Event.names.SESSION_CONNECTED,W.connections,W.streams,W.archives))},c=function(W){g=false;E=false;console.error(W.reason);this.trigger("sessionConnectFailed",W.reason);switch(W.code){case 409:TB.handleJsException("TB.SessionConnectionFailed :: The P2P session already has two participants.",OT.ExceptionCodes.CONNECT_REJECTED,{session:this});break;case 410:TB.handleJsException("TB.SessionConnectionFailed :: The session already has four participants.",OT.ExceptionCodes.CONNECT_REJECTED,{session:this});break;default:TB.handleJsException("TB.SessionConnectionFailed :: The session failed to connect.",OT.ExceptionCodes.CONNECT_FAILED,{session:this});break}},B=function(X,W){TB.handleJsException(X,W,{session:this})},U=function(Y){var X=new OT.SessionDisconnectEvent("sessionDisconnected",Y.reason);F.call(this);C.call(this);var W=function(){if(!X.isDefaultPrevented()){h.call(this)}};this.dispatchEvent(X,OT._.bind(W,this))},K=function(W){z[W.connection.connectionId]=W.connection;W.connections=[W.connection];delete W.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_CREATED,W.connections))},D=function(X){if(m!==X.connection.connectionId){delete z[X.connection.connectionId]}for(var W in M){M[W].cleanupSubscriber(X.connection.connectionId)}X.connections=[X.connection];delete X.connection;this.dispatchEvent(new OT.ConnectionEvent(OT.Event.names.CONNECTION_DESTROYED,X.connections,X.reason))},v=function(W){W.streams=OT._.filter(W.streams,A);OT.debug(W.streams);if(W.streams.length>0){S(W.streams);W.streams.forEach(function(Y){var X=u(Y.id);if(X){X._.publishedToSessionHandler()}});this.dispatchEvent(new OT.StreamEvent(OT.Event.names.STREAM_CREATED,W.streams,W.reason))}},s=function(Y){OT.debug(Y);var aa={orientation:"videoDimensions",hasAudio:"hasAudio",hasVideo:"hasVideo"};var ac=Y.key.split("/"),ad=q(Y.streamId),ae,ab,Z,X=Y.value,W;ac=ac.length>0?ac[ac.length-1]:null;if(!ac||!aa[ac]){OT.warn("Unknown stream property was modified.");return}ab=aa[ac];W=o(Y.streamId,ab,Y.value);if(ac==="orientation"){ae=T[Y.streamId];if(ae){ae.streamOrientationDidChange(Y.value.width,Y.value.height,Y.value.videoOrientation)}X={width:X.width,height:X.height}}this.dispatchEvent(new OT.StreamPropertyChangedEvent(OT.Event.names.STREAM_PROPERTY_CHANGED,ad,ab,W,X))},b=function(Y){if(Y.streams.length<=0){return}Y.streams=OT._.filter(Y.streams,function(Z){return A(Z)});var X=new OT.StreamEvent("streamDestroyed",Y.streams,Y.reason);var W=function(){var Z=!X.isDefaultPrevented();Y.streams.forEach(function(ad){var ab=u(ad.id);if(ab){ab.disconnect();if(Z){t(ab)}delete M[ab.guid]}for(var ac in T){if(ac===ad.id){var aa=T[ac];aa.disconnect();if(Z){this.unsubscribe(aa)}delete T[ac]}}k(ad.id)},this)};this.dispatchEvent(X,OT._.bind(W,this))},i=function(X){console.log("jsepMessageHandler: "+JSON.stringify(X));if(!z[X.fromAddress]){OT.warn("OT.Session.onMessage: Received peerConnectionData from an unknown connection.");z[X.fromAddress]=new OT.Connection(X.fromAddress,new Date(),null,{supportsWebRTC:true})}if(X.hasOwnProperty("streamId")){var W=null;if(X.type==OT.WebSocketMessageType.JSEP_SUBSCRIBE){W=u(X.streamId,true)}else{W=u(X.streamId,true)||T[X.streamId]}if(!W){OT.warn("OT.Session.onMessage: Received peerConnectionData for an unknown publisher.");return}W.processMessage(X.type,z[X.fromAddress],X)}},j=function(X){var W=new OT.SignalEvent("signalReceived",z[X.fromAddress]);this.dispatchEvent(W)},F=function(){L=null;n=null;m=null;g=false;d=null;z={};O={}},C=function(){for(var W in M){M[W].disconnect()}for(var X in T){T[X].disconnect()}},t=function(W){if(V[W.guid]){W.off("destroyed",V[W.guid]);delete V[W.guid]}W.destroy()},h=function(){for(var W in M){t(M[W])}M={};V={};for(var X in T){T[X].destroy()}T={}},I=function(W){V[W.guid]=OT._.bind(function(){this.unpublish(W)},this);W.on("destroyed",V[W.guid])},P=function(){if(R){console.log("connectToMessenger");var W=function(X){return function(Y){return function(){return Y.apply(X,arguments)}}}(this);f=new OT.Messenger(this.sessionInfo.messagingServer,new OT.SessionMessageWrangler(this)).on({SessionConnected:W(w),SessionConnectFailed:W(c),ConnectionClosed:W(U),ConnectionCreated:W(K),ConnectionDestroyed:W(D),StreamCreated:W(v),StreamModified:W(s),StreamDestroyed:W(b),JSEPMessageReceived:W(i),SignalReceived:W(j),exception:W(B)});f.connect(r,n,{requireConnectionObjects:this.properties.requireConnectionObjects,p2pEnabled:this.sessionInfo.p2pEnabled,widgetId:x,partnerId:L})}},N=function(){if(!E){return}setTimeout(function(){p.logEvent({action:"getSessionInfo",variation:"Attempt",payload_type:"api_url",payload:OT.BUILD_PROPERTIES.apiURL,session_id:r,partner_id:L,widget_id:x})},0);var W=OT.BUILD_PROPERTIES.apiURL+"/session/"+r+"?extended=true";OT.$.getXML(W,{headers:{"X-TB-TOKEN-AUTH":n,"X-TB-VERSION":1},success:OT._.bind(Q,this),error:OT._.bind(H,this)})},Q=function(W){if(!E){return}this.sessionInfo=new OT.SessionInfo(W);if(this.sessionInfo.validSession){this.properties={requireConnectionObjects:true};if(this.sessionInfo&&this.sessionInfo.partnerId){L=this.sessionInfo.partnerId}p.logEvent({action:"getSessionInfo",variation:"Success",payload_type:"api_url",payload:OT.BUILD_PROPERTIES.apiURL,session_id:r,partner_id:L,widget_id:x});if(this.sessionInfo.partnerId!==null&&this.sessionInfo.sessionStatus!==null){R=true}P.call(this)}else{TB.handleJsException("TB.SessionInfoError :: Unable to get session info "+this.sessionInfo.errorMessage,OT.ExceptionCodes.INVALID_SESSION_ID,{session:this});p.logError({action:"getSessionInfo",variation:"Failure",payload_type:"errorMessage",payload:"TB.SessionInfoError :: Unable to get session info "+this.sessionInfo.errorMessage,session_id:r,partner_id:L,widget_id:x})}},H=function(W){E=false;p.logEvent({action:"getSessionInfo",variation:"Failure",payload_type:"api_url",payload:OT.BUILD_PROPERTIES.apiURL,session_id:r,partner_id:L,widget_id:x});TB.handleJsException("TB.SessionInfoError :: There was an error while getting the session info.",OT.ExceptionCodes.API_RESPONSE_FAILURE,{session:this})},y=function(W){return d[W]===1};this.connect=function(Y,X,W){if(g){OT.warn("OT.Session: Cannot connect, already connected.");return}if(E){OT.warn("OT.Session: Cannot connect, already connecting.");return}E=true;F.call(this);L=Y.toString();if(OT.APIKEY.length===0){OT.APIKEY=L}n=X;N.call(this)};this.disconnect=function(){E=false;if(f){f.disconnect();f=null;R=false}};this.publish=function(Y,W){var X;if(!g){p.logError(1010,"tb.exception","We need to be connected before you can publish",null,{action:"publish",variation:"Failure",payload_type:"reason",payload:"We need to be connected before you can publish",session_id:r,partner_id:L,widgetId:x});X="We need to be connected before you can publish";OT.error(X);throw new Error(X)}if(!y("publish")){p.logEvent({action:"publish",variation:"Failure",payload_type:"reason",payload:"This token does not allow publishing. The role must be at least `publisher` to enable this functionality",session_id:r,partner_id:L,widgetId:x});TB.handleJsException("This token does not allow publishing. The role must be at least `publisher` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_PUBLISH,{session:this});return null}if(!Y||typeof(Y)==="string"){Y=OT.initPublisher(this.apiKey,Y,W)}else{if(Y instanceof OT.rtc.Publisher||Y instanceof OT.flash.Publisher){if("session" in Y&&Y.session&&"sessionId" in Y.session){if(Y.session.sessionId===this.sessionId){OT.warn("Cannot publish "+Y.guid+" again to "+this.sessionId+". Please call session.unpublish(publisher) first.")}else{OT.warn("Cannot publish "+Y.guid+" publisher already attached to "+Y.session.sessionId+". Please call session.unpublish(publisher) first.")}}}else{X="Session.publish :: First parameter passed in is neither a string nor an instance of the Publisher";OT.error(X);throw new Error(X)}}M[Y.guid]=Y;Y._.publishToSession(this);I.call(this,Y);return Y};this.unpublish=function(W){if(!W){OT.error("OT.Session.unpublish: publisher parameter missing.");return}W._.unpublishFromSession(this)};this.modifyStream=function(Y,W,X){if(!Y||!W||!X){OT.error("OT.Session.modifyStream: must provide streamId, key and value to modify a stream property.")}f.sendMessage(OT.WebSocketMessage.modifyStream(Y,W,X))};this.subscribe=function(aa,W,X){var Z;if(!this.connection||!this.connection.connectionId){Z="Session.subscribe :: Connection required to subscribe";OT.error(Z);throw new Error(Z)}if(!aa){Z="Session.subscribe :: stream cannot be null";OT.error(Z);throw new Error(Z)}if(!aa.hasOwnProperty("streamId")){Z="Session.subscribe :: invalid stream object";OT.error(Z);throw new Error(Z)}var Y=new OT.rtc.Subscriber(W,OT._.extend(X||{},{session:this}));T[aa.streamId]=Y;Y.subscribe(aa);return Y};this.unsubscribe=function(W){if(!W){var X="OT.Session.unsubscribe: subscriber cannot be null";OT.error(X);throw new Error(X)}if(!W.stream){OT.warn("OT.Session.unsubscribe:: tried to unsubscribe a subscriber that had no stream");return false}OT.debug("OT.Session.unsubscribe: subscriber "+W.id);delete T[W.stream.id];W.destroy();return true};this.getSubscribersForStream=function(W){return[T[W.id]]};this.getPublisherForStream=function(X){var W;if(typeof(X)=="string"){W=X}else{if(typeof(X)=="object"&&X&&X.hasOwnProperty("id")){W=X.id}else{errorMsg="Session.getPublisherForStream :: Invalid stream type";OT.error(errorMsg);throw new Error(errorMsg)}}return u(W)};this.sendMessage=function(){return f.sendMessage.apply(f,arguments)};this.sendJSEPMessage=function(Y,W,X){if(f&&f.connectionId){f.sendMessage(OT.WebSocketMessage.jsepMessage(f.connectionId,Y.connectionId,W,X))}else{OT.warn("Session.sendJSEPMessage :: Tried to send a message without a _messenger")}};this.forceDisconnect=function(W){if(y("forceDisconnect")){var X=typeof(W)==="string"?W:W.id;f.sendMessage(OT.WebSocketMessage.forceDisconnect(X))}else{TB.handleJsException("This token does not allow forceDisconnect. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_DISCONNECT,{session:this})}};this.forceUnpublish=function(W){if(y("forceUnpublish")){var X=typeof(W)==="string"?W:W.id;f.sendMessage(OT.WebSocketMessage.forceUnpublish(X))}else{TB.handleJsException("This token does not allow forceUnpublish. The role must be at least `moderator` to enable this functionality",OT.ExceptionCodes.UNABLE_TO_FORCE_UNPUBLISH,{session:this})}};this.getStateManager=function(){OT.warn("Fixme: Have not implemented session.getStateManager")};this.__defineGetter__("apiKey",function(){return L});this.__defineGetter__("token",function(){return n});this.__defineGetter__("connected",function(){return g});this.__defineGetter__("connection",function(){return z[m]});this.__defineSetter__("connection",function(W){if(W.hasOwnProperty("connectionId")){m=W.connectionId;z[m]=W}});this.__defineGetter__("capabilities",function(){return d});this.__defineGetter__("sessionId",function(){return r});this.__defineGetter__("id",function(){return r});this.__defineGetter__("connections",function(){return z});this.__defineGetter__("publishers",function(){return M})}})(window);(function(a){OT.SessionMessageWrangler=function(f){var d=function(g){return new OT.Connection(g.connectionId,g.creationTime,g.data,{supportsWebRTC:g.supportsWebRTC})},e=function(g){return Object.keys(g).map(function(h){return d(g[h])})},b=function(i,g){function j(o){if(f.connections[i.connection.connectionId]){return f.connections[i.connection.connectionId]}else{if(g){for(var m=0,n=g.length;m<n;++m){if(o===g[m].id){return g[m]}}}}return null}var k=new OT.Stream(i.streamId,j(i.connection.connectionId),i.name,i.streamData,i.type,i.creationTime,i.hasAudio,i.hasVideo,i.orientation?i.orientation:{videoOrientation:"OTVideoOrientationRotatedNormal",width:640,height:480},f.id,i.peerId,i.quality,i.orientation?i.orientation.width:640,i.orientation?i.orientation.height:480);var h;if(i.publisherId){h=f.publishers[i.publisherId]}else{h=f.getPublisherForStream(k.id)}if(h){h.stream=k}return k},c=function(i,h){var k=[];for(var g in i){if(i.hasOwnProperty(g)){var j=b(i[g],h);if(j){k.push(j)}}}return k};this.wrangle=function(g){if(g.sessionState){if(g.sessionState.CONNECTIONS){g.connections=e(g.sessionState.CONNECTIONS)}if(g.sessionState.STREAMS){g.streams=c(g.sessionState.STREAMS,g.connections)}}else{if(g.streams){g.streams=c(g.streams,g.connections)}if(g.connection){g.connection=d(g.connection)}}return g}}})(window);(function(a){OT.onLoad(function(){var b=document.createElement("link");b.type="text/css";b.media="screen";b.rel="stylesheet";b.href=OT.BUILD_PROPERTIES.cssURL+"/ot.css";document.head.appendChild(b)})})(window);